// Bu.js v0.4.0 - https://github.com/jarvisniu/Bu.js
"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){function t(t,e){var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(h){r=!0,s=h}finally{try{!i&&a["return"]&&a["return"]()}finally{if(r)throw s}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bu=function(){var t,e,n,i,r,s={}.hasOwnProperty;t=window.Bu={global:window},t.version="0.4.0",t.BROWSER_VENDOR_PREFIXES=["webkit","moz","ms"],t.HALF_PI=Math.PI/2,t.TWO_PI=2*Math.PI,t.DEFAULT_FONT_FAMILY="Verdana",t.DEFAULT_FONT_SIZE=11,t.DEFAULT_FONT="11px Verdana",t.POINT_RENDER_SIZE=2.25,t.POINT_LABEL_OFFSET=5,t.DEFAULT_SPLINE_SMOOTH=.25,t.DEFAULT_NEAR_DIST=5,t.MOUSE={NONE:0,LEFT:1,RIGHT:2,MIDDLE:4},t.average=function(){var t,e,n,i,r;for(i=arguments,"object"===_typeof(arguments[0])&&(i=arguments[0]),r=0,e=0,n=i.length;e<n;e++)t=i[e],r+=t;return r/i.length},t.bevel=function(t,e){return Math.sqrt(t*t+e*e)},t.clamp=function(t,e,n){return t<e&&(t=e),t>n&&(t=n),t},t.rand=function(t,e){if(null==e){var n=[0,t];t=n[0],e=n[1]}return Math.random()*(e-t)+t},t.r2d=function(t){return(180*t/Math.PI).toFixed(1)},t.d2r=function(t){return t*Math.PI/180},t.now=null!=t.global.performance?function(){return t.global.performance.now()}:function(){return Date.now()},t.combineOptions=function(e,n){var i,r;if(null==n&&(n={}),i=e[e.length-1],t.isPlainObject(i))for(r in i)null!=i[r]&&(n[r]=i[r]);return n},t.isNumber=function(t){return"number"==typeof t},t.isString=function(t){return"string"==typeof t},t.isPlainObject=function(t){return t instanceof Object&&"Object"===t.constructor.name},t.isFunction=function(t){return t instanceof Object&&"Function"===t.constructor.name},t.isArray=function(t){return t instanceof Array},t.clone=function(e){var n,i;if("object"!==("undefined"==typeof e?"undefined":_typeof(e))||null===e||t.isFunction(e))return e;if(null!=e.clone)return e.clone();n=t.isArray(e)?[]:t.isPlainObject(e)?{}:Object.create(e.constructor.prototype);for(i in e)s.call(e,i)&&(n[i]=t.clone(e[i]));return n},t.data=function(t,e){return null!=e?localStorage["Bu."+t]=JSON.stringify(e):(e=localStorage["Bu."+t],null!=e?JSON.parse(e):null)},t.ready=function(t,e,n){return"complete"===document.readyState?t.apply(e,n):document.addEventListener("DOMContentLoaded",function(){return t.apply(e,n)})},Function.prototype.property=function(t,e){return Object.defineProperty(this.prototype,t,e)},Function.prototype.throttle=function(){var t,e,n=this,i=arguments,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;return t=0,e=0,function(){if(t=Date.now(),t-e>1e3*r)return n.apply(null,i),e=t}},Function.prototype.debounce=function(){var t,e,n,i=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;return t=null,n=null,e=function(){return i.apply(null,t)},function(){return t=arguments,clearTimeout(n),n=setTimeout(e,1e3*r)}},(e=Array.prototype).each||(e.each=function(t){var e;for(e=0;e<this.length;)t(this[e]),e++;return this}),(n=Array.prototype).map||(n.map=function(t){var e,n;for(e=[],n=0;n<this.length;)e.push(t(this[n])),n++;return this}),i=Date.now(),r=t.data("version.timestamp"),null!=r&&i-r<6e4||("function"==typeof console.info&&console.info("Bu.js v"+t.version+" - [https://github.com/jarvisniu/Bu.js]"),t.data("version.timestamp",i));var o,a=t;o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,t),this.x=e,this.y=n}return _createClass(t,[{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"offset",value:function(t,e){return this.x+=t,this.y+=e,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"project",value:function(t){var e,n;return this.x*=t.scale.x,this.y*=t.scale.y,n=Bu.bevel(this.x,this.y),e=Math.atan2(this.y,this.x)+t.rotation,this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.x+=t.position.x,this.y+=t.position.y,this}},{key:"unProject",value:function(t){var e,n;return this.x-=t.position.x,this.y-=t.position.y,n=Bu.bevel(this.x,this.y),e=Math.atan2(this.y,this.x)-t.rotation,this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.x/=t.scale.x,this.y/=t.scale.y,this}}]),t}();var h,u=o;h=function(){function t(e){_classCallCheck(this,t),this.update=this.update.bind(this),this.target=e,this.x1=this.y1=this.x2=this.y2=0,this.isEmpty=!0,this.point1=new u,this.point2=new u,this.update(),this.bindEvent()}return _createClass(t,[{key:"containsPoint",value:function(t){return this.x1<t.x&&this.x2>t.x&&this.y1<t.y&&this.y2>t.y}},{key:"update",value:function(){var t,e,n,i,r,s,o,a,h;switch(this.clear(),this.target.type){case"Line":case"Triangle":case"Rectangle":for(r=this.target.points,o=[],t=0,n=r.length;t<n;t++)h=r[t],o.push(this.expandByPoint(h));return o;case"Circle":case"Bow":case"Fan":return this.expandByCircle(this.target);case"Polyline":case"Polygon":for(s=this.target.vertices,a=[],e=0,i=s.length;e<i;e++)h=s[e],a.push(this.expandByPoint(h));return a;case"Ellipse":return this.x1=-this.target.radiusX,this.x2=this.target.radiusX,this.y1=-this.target.radiusY,this.y2=this.target.radiusY;default:return console.warn("Bounds: not support shape type "+this.target.type)}}},{key:"bindEvent",value:function(){switch(this.target.type){case"Circle":case"Bow":case"Fan":return this.target.on("centerChanged",this.update),this.target.on("radiusChanged",this.update);case"Ellipse":return this.target.on("changed",this.update)}}},{key:"clear",value:function(){return this.x1=this.y1=this.x2=this.y2=0,this.isEmpty=!0,this}},{key:"expandByPoint",value:function(t){return this.isEmpty?(this.isEmpty=!1,this.x1=this.x2=t.x,this.y1=this.y2=t.y):(t.x<this.x1&&(this.x1=t.x),t.x>this.x2&&(this.x2=t.x),t.y<this.y1&&(this.y1=t.y),t.y>this.y2&&(this.y2=t.y)),this}},{key:"expandByCircle",value:function(t){var e,n;return e=t.center,n=t.radius,this.isEmpty?(this.isEmpty=!1,this.x1=e.x-n,this.x2=e.x+n,this.y1=e.y-n,this.y2=e.y+n):(e.x-n<this.x1&&(this.x1=e.x-n),e.x+n>this.x2&&(this.x2=e.x+n),e.y-n<this.y1&&(this.y1=e.y-n),e.y+n>this.y2&&(this.y2=e.y+n)),this}}]),t}();var l,c=h;l=function(){var t,e,n,i,r,s,o,a,h,u,l,c=function(){function c(){_classCallCheck(this,c);var t;this.r=this.g=this.b=255,this.a=1,1===arguments.length?(t=arguments[0],Bu.isString(t)?(this.parse(t),this.a=u(this.a)):t instanceof c&&this.copy(t)):(this.r=arguments[0],this.g=arguments[1],this.b=arguments[2],this.a=arguments[3]||1)}return _createClass(c,[{key:"parse",value:function(u){var c,p,d,y,f;if(c=u.match(s))this.r=+c[1],this.g=+c[2],this.b=+c[3],this.a=1;else if(c=u.match(i)){p=+c[1],f=+c[2]/100,y=+c[3]/100;var g=l(p,f,y),v=_slicedToArray(g,3);this.r=v[0],this.g=v[1],this.b=v[2],this.a=1}else if(c=u.match(o))this.r=+c[1],this.g=+c[2],this.b=+c[3],this.a=+c[4];else if(c=u.match(r)){p=+c[1],f=+c[2]/100,y=+c[3]/100;var m=l(p,f,y),x=_slicedToArray(m,3);this.r=x[0],this.g=x[1],this.b=x[2],this.a=parseFloat(c[4])}else(c=u.match(a))?(this.r=255*+c[1]/100,this.g=255*+c[2]/100,this.b=255*+c[3]/100,this.a=+c[4]):(c=u.match(h))?(this.r=255*+c[1]/100,this.g=255*+c[2]/100,this.b=255*+c[3]/100,this.a=1):(c=u.match(e))?(d=c[1],this.r=parseInt(d[0],16),this.r=16*this.r+this.r,this.g=parseInt(d[1],16),this.g=16*this.g+this.g,this.b=parseInt(d[2],16),this.b=16*this.b+this.b,this.a=1):(c=u.match(n))?(d=c[1],this.r=parseInt(d.substring(0,2),16),this.g=parseInt(d.substring(2,4),16),this.b=parseInt(d.substring(4,6),16),this.a=1):null!=t[u=u.toLowerCase().trim()]?(this.r=t[u][0],this.g=t[u][1],this.b=t[u][2],this.a=t[u][3],null==this.a&&(this.a=1)):console.error('Color.parse("'+u+'") error.');return this}},{key:"clone",value:function(){return(new c).copy(this)}},{key:"copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}},{key:"setRGB",value:function(t,e,n){return this.r=parseInt(t),this.g=parseInt(e),this.b=parseInt(n),this.a=1,this}},{key:"setRGBA",value:function(t,e,n,i){return this.r=parseInt(t),this.g=parseInt(e),this.b=parseInt(n),this.a=u(parseFloat(i)),this}},{key:"toRGB",value:function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"}},{key:"toRGBA",value:function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.a+")"}}]),c}();return u=function(t){return Bu.clamp(t,0,1)},l=function(t,e,n){var i,r,s,o,a,h,u;for(t%=360,t/=360,a=n<.5?n*(1+e):n+e-n*e,o=2*n-a,u=[t+1/3,t,t-1/3],h=[],i=r=0;r<=2;i=++r)u[i]<0&&(u[i]+=1),u[i]>1&&(u[i]-=1);for(i=s=0;s<=2;i=++s)u[i]<1/6?h[i]=o+6*(a-o)*u[i]:u[i]<.5?h[i]=a:u[i]<2/3?h[i]=o+6*(a-o)*(2/3-u[i]):h[i]=o,h[i]=Math.round(255*h[i]);return h},i=/hsl\(\s*(\d+),\s*(\d+)%,\s*(\d+)%\s*\)/i,r=/hsla\(\s*(\d+),\s*(\d+)%,\s*(\d+)%\s*,\s*([.\d]+)\s*\)/i,s=/rgb\(\s*(\d+),\s*(\d+),\s*(\d+)\s*\)/i,o=/rgba\(\s*(\d+),\s*(\d+),\s*(\d+)\s*,\s*([.\d]+)\s*\)/i,h=/rgb\(\s*(\d+)%,\s*(\d+)%,\s*(\d+)%\s*\)/i,a=/rgba\(\s*(\d+)%,\s*(\d+)%,\s*(\d+)%\s*,\s*([.\d]+)\s*\)/i,e=/#([0-9A-F]{3})\s*$/i,n=/#([0-9A-F]{6})\s*$/i,t={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},c}();var p,d=l;p=function(){function t(e,n){_classCallCheck(this,t),this.width=e,this.height=n,this.type="Size"}return _createClass(t,[{key:"set",value:function(t,e){this.width=t,this.height=e}}]),t}();var y,f=p;y=function(){var t;return t={},this.on=function(e,n){var i;if(i=t[e]||(t[e]=[]),i.indexOf(n===-1))return i.push(n)},this.once=function(t,e){return e.once=!0,this.on(t,e)},this.off=function(e,n){var i,r;if(r=t[e],null!=n){if(null!=r&&(i=r.indexOf(n),i>-1))return r.splice(i,1)}else if(null!=r)return r.length=0},this.trigger=function(e,n){var i,r,s,o,a;if(o=t[e],null!=o){for(n||(n={}),n.target=this,a=[],i=0,r=o.length;i<r;i++)s=o[i],s.call(this,n),s.once?a.push(o.splice(o.indexOf(s),1)):a.push(void 0);return a}}};var g,v=y;g=function(){return this.strokeStyle=g.DEFAULT_STROKE_STYLE,this.fillStyle=g.DEFAULT_FILL_STYLE,this.dashStyle=!1,this.dashFlowSpeed=0,this.lineWidth=1,this.dashOffset=0,this.style=function(t){var e,n,i,r;for(Bu.isString(t)?(t=Bu.styles[t],null==t&&(t=Bu.styles["default"],console.warn("Styled: Bu.styles."+t+" doesn't exists, fell back to default."))):null==t&&(t=Bu.styles["default"]),r=["strokeStyle","fillStyle","dashStyle","dashFlowSpeed","lineWidth"],e=0,i=r.length;e<i;e++)n=r[e],this[n]=t[n];return this},this.stroke=function(t){switch(null==t&&(t=!0),null!=Bu.styles&&t in Bu.styles&&(t=Bu.styles[t].strokeStyle),t){case!0:this.strokeStyle=g.DEFAULT_STROKE_STYLE;break;case!1:this.strokeStyle=null;break;default:this.strokeStyle=t}return this},this.fill=function(t){switch(null==t&&(t=!0),null!=Bu.styles&&t in Bu.styles&&(t=Bu.styles[t].fillStyle),t){case!1:this.fillStyle=null;break;case!0:this.fillStyle=g.DEFAULT_FILL_STYLE;break;default:this.fillStyle=t}return this},this.dash=function(t){switch(null==t&&(t=!0),null!=Bu.styles&&t in Bu.styles&&(t=Bu.styles[t].dashStyle),Bu.isNumber(t)&&(t=[t,t]),t){case!1:this.dashStyle=null;break;case!0:this.dashStyle=g.DEFAULT_DASH_STYLE;break;default:this.dashStyle=t}return this},this.dashFlow=function(t){return t!==!0&&null!=t||(t=1),t===!1&&(t=0),Bu.dashFlowManager.setSpeed(this,t),this},this.setLineWidth=function(t){return this.lineWidth=t,this},this},g.DEFAULT_STROKE_STYLE="#048",g.DEFAULT_FILL_STYLE="rgba(64, 128, 192, 0.5)",g.DEFAULT_DASH_STYLE=[8,4],Bu.styles={"default":(new g).stroke().fill(),hover:(new g).stroke("hsla(0, 100%, 40%, 0.75)").fill("hsla(0, 100%, 75%, 0.5)"),text:(new g).stroke(!1).fill("black"),line:(new g).fill(!1),selected:(new g).setLineWidth(3),dash:(new g).dash()};var m,x=g,w={}.hasOwnProperty;m=function(){var t=function(){function t(){_classCallCheck(this,t),x.apply(this),v.apply(this),this.visible=!0,this.opacity=1,this.position=new u,this.rotation=0,this._scale=new u(1,1),this.skew=new u,this.bounds=null,this.keyPoints=null,this.children=[],this.parent=null}return _createClass(t,[{key:"translate",value:function(t,e){return this.position.x+=t,this.position.y+=e,this}},{key:"rotate",value:function(t){return this.rotation+=t,this}},{key:"scaleBy",value:function(t){return this.scale*=t,this}},{key:"scaleTo",value:function(t){return this.scale=t,this}},{key:"getScene",value:function(){var t;for(t=this;;){if(t instanceof Bu.Scene)break;t=t.parent}return t}},{key:"addChild",value:function(t){var e,n,i;if(Bu.isArray(t))for(e=0,n=t.length;e<n;e++)i=t[e],this.children.push(i),i.parent=this;else this.children.push(t),t.parent=this;return this}},{key:"removeChild",value:function(t){var e;return e=this.children.indexOf(t),e>-1&&this.children.splice(e,1),this}},{key:"animate",value:function(t,e){var n;if(Bu.isArray(e)||(e=[e]),Bu.isString(t))t in Bu.animations?Bu.animations[t].applyTo(this,e):console.warn('Bu.animations["'+t+"\"] doesn't exists.");else if(Bu.isArray(t))for(n in t)w.call(t,n)&&this.animate(t[n],e);else t.applyTo(this,e);return this}},{key:"createBounds",value:function(){return this.bounds=new c(this),this}},{key:"hitTest",value:function(t){var e;return e=this.getScene().renderer,e.originAtCenter&&t.offset(-e.width/2,-e.height/2),t.project(e.camera),t.unProject(this),this.containsPoint(t)}},{key:"containsPoint",value:function(t){return!(null!=this.bounds&&!this.bounds.containsPoint(t))&&(!!this._containsPoint&&this._containsPoint(t))}}]),t}();return t.prototype.type="Object2D",t.prototype.fillable=!1,t.property("scale",{get:function(){return this._scale},set:function(t){return Bu.isNumber(t)?this._scale.x=this._scale.y=t:this._scale=t}}),t}();var _,b=m;_=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.type="Camera",t}return _inherits(e,t),e}(b);var k,P=_;k=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.type="Scene",t.background=e.DEFAULT_BACKGROUND,t.renderer=null,t}return _inherits(e,t),e}(b),k.DEFAULT_BACKGROUND="#eee";var T,S=k;T=function(){var t=function(){function t(){var e=this;_classCallCheck(this,t);var n,i,r,s,o,a,h,u,l,c;for(this.drawShapes=this.drawShapes.bind(this),this.drawShape=this.drawShape.bind(this),v.apply(this),this.type="Renderer",this.scene=new S(this),this.camera=new P,this.tickCount=0,this.isRunning=!0,this.pixelRatio=Bu.global.devicePixelRatio||1,"undefined"!=typeof ClipMeter&&null!==ClipMeter&&(this.clipMeter=new ClipMeter),u=Bu.combineOptions(arguments,{container:"body",showKeyPoints:!1,showBounds:!1,originAtCenter:!1,imageSmoothing:!0}),l=["container","width","height","showKeyPoints","showBounds","originAtCenter"],s=0,o=l.length;s<o;s++)a=l[s],this[a]=u[a];this.fillParent=!Bu.isNumber(u.width),this.pixelWidth=this.width*this.pixelRatio,this.pixelHeight=this.height*this.pixelRatio,this.dom=document.createElement("canvas"),this.dom.style.cursor=u.cursor||"default",this.dom.style.boxSizing="content-box",this.dom.oncontextmenu=function(){return!1},this.context=this.dom.getContext("2d"),this.context.textBaseline="top",Bu.isString(this.container)&&(this.container=document.querySelector(this.container)),this.fillParent&&this.container===document.body&&(r=document.querySelector("html"),i=document.querySelector("body"),i.style.margin="0",i.style.overflow="hidden",r.style.width=r.style.height=i.style.width=i.style.height="100%"),h=function(){var t,n;return t=e.dom.height/e.dom.width,n=e.container.clientHeight/e.container.clientWidth,n<t?(e.height=e.container.clientHeight,e.width=e.height/n):(e.width=e.container.clientWidth,e.height=e.width*n),e.pixelWidth=e.dom.width=e.width*e.pixelRatio,e.pixelHeight=e.dom.height=e.height*e.pixelRatio,e.dom.style.width=e.width+"px",e.dom.style.height=e.height+"px",e.render()},this.fillParent?(this.pixelWidth=this.container.clientWidth,this.pixelHeight=this.container.clientHeight,this.width=this.pixelWidth/this.pixelRatio,this.height=this.pixelHeight/this.pixelRatio,Bu.global.window.addEventListener("resize",h),this.dom.addEventListener("DOMNodeInserted",h)):(this.dom.style.width=this.width+"px",this.dom.style.height=this.height+"px",this.dom.width=this.pixelWidth,this.dom.height=this.pixelHeight),c=function(){return e.isRunning&&(null!=e.clipMeter&&e.clipMeter.start(),e.render(),e.trigger("update",e),e.tickCount+=1,null!=e.clipMeter&&e.clipMeter.tick()),requestAnimationFrame(c)},c(),n=function(){return e.container.appendChild(e.dom),e.imageSmoothing=u.imageSmoothing},setTimeout(n,1),Bu.animationRunner.hookUp(this),Bu.dashFlowManager.hookUp(this)}return _createClass(t,[{key:"pause",value:function(){return this.isRunning=!1}},{key:"continue",value:function(){return this.isRunning=!0}},{key:"toggle",value:function(){return this.isRunning=!this.isRunning}},{key:"render",value:function(){return this.context.save(),this.clearCanvas(),this.originAtCenter&&this.context.translate(this.pixelWidth/2,this.pixelHeight/2),this.context.scale(this.pixelRatio,this.pixelRatio),this.context.scale(1/this.camera.scale.x,1/this.camera.scale.y),this.context.rotate(-this.camera.rotation),this.context.translate(-this.camera.position.x,-this.camera.position.y),this.drawShape(this.scene),this.context.restore(),this}},{key:"clearCanvas",value:function(){return this.context.fillStyle=this.scene.background,this.context.fillRect(0,0,this.pixelWidth,this.pixelHeight),this}},{key:"drawShapes",value:function(t){var e,n,i;if(null!=t)for(e=0,n=t.length;e<n;e++)i=t[e],this.context.save(),this.drawShape(i),this.context.restore();return this}},{key:"drawShape",value:function(t){var e,n,i;if(!t.visible)return this;switch(this.context.translate(t.position.x,t.position.y),this.context.rotate(t.rotation),n=t.scale.x,i=t.scale.y,(n/i>100||n/i<.01)&&(Math.abs(n)<.02&&(n=0),Math.abs(i)<.02&&(i=0)),this.context.scale(n,i),this.context.globalAlpha*=t.opacity,null!=t.strokeStyle&&(this.context.strokeStyle=t.strokeStyle,this.context.lineWidth=t.lineWidth,null!=t.lineCap&&(this.context.lineCap=t.lineCap),null!=t.lineJoin&&(this.context.lineJoin=t.lineJoin)),this.context.beginPath(),t.type){case"Point":this.drawPoint(t);break;case"Line":this.drawLine(t);break;case"Circle":this.drawCircle(t);break;case"Ellipse":this.drawEllipse(t);break;case"Triangle":this.drawTriangle(t);break;case"Rectangle":this.drawRectangle(t);break;case"Fan":this.drawFan(t);break;case"Bow":this.drawBow(t);break;case"Polygon":this.drawPolygon(t);break;case"Polyline":this.drawPolyline(t);break;case"Spline":this.drawSpline(t);break;case"PointText":this.drawPointText(t);break;case"Image":this.drawImage(t);break;case"Object2D":case"Scene":break;default:console.log("drawShapes(): unknown shape: ",t.type,t)}return null!=t.fillStyle&&t.fillable&&(this.context.fillStyle=t.fillStyle,this.context.fill()),t.dashStyle?(this.context.lineDashOffset=t.dashOffset,"function"==typeof(e=this.context).setLineDash&&e.setLineDash(t.dashStyle),this.context.stroke(),this.context.setLineDash([])):null!=t.strokeStyle&&this.context.stroke(),null!=t.children&&this.drawShapes(t.children),this.showKeyPoints&&this.drawShapes(t.keyPoints),this.showBounds&&null!=t.bounds&&this.drawBounds(t.bounds),this}},{key:"drawPoint",value:function(t){return this.context.arc(t.x,t.y,Bu.POINT_RENDER_SIZE,0,Bu.TWO_PI),this}},{key:"drawLine",value:function(t){return this.context.moveTo(t.points[0].x,t.points[0].y),this.context.lineTo(t.points[1].x,t.points[1].y),this}},{key:"drawCircle",value:function(t){return this.context.arc(t.cx,t.cy,t.radius,0,Bu.TWO_PI),this}},{key:"drawEllipse",value:function(t){return this.context.ellipse(0,0,t.radiusX,t.radiusY,0,Bu.TWO_PI,!1),this}},{key:"drawTriangle",value:function(t){return this.context.lineTo(t.points[0].x,t.points[0].y),this.context.lineTo(t.points[1].x,t.points[1].y),this.context.lineTo(t.points[2].x,t.points[2].y),this.context.closePath(),this}},{key:"drawRectangle",value:function(t){return 0!==t.cornerRadius?this.drawRoundRectangle(t):(this.context.rect(t.pointLT.x,t.pointLT.y,t.size.width,t.size.height),this)}},{key:"drawRoundRectangle",value:function(t){var e,n,i,r,s,o;return i=t.pointLT.x,r=t.pointRB.x,s=t.pointLT.y,o=t.pointRB.y,n=t.cornerRadius,this.context.moveTo(i,s+n),this.context.arcTo(i,s,i+n,s,n),this.context.lineTo(r-n,s),this.context.arcTo(r,s,r,s+n,n),this.context.lineTo(r,o-n),this.context.arcTo(r,o,r-n,o,n),this.context.lineTo(i+n,o),this.context.arcTo(i,o,i,o-n,n),this.context.closePath(),null!=t.strokeStyle&&t.dashStyle&&"function"==typeof(e=this.context).setLineDash&&e.setLineDash(t.dashStyle),this}},{key:"drawFan",value:function(t){return this.context.arc(t.cx,t.cy,t.radius,t.aFrom,t.aTo),this.context.lineTo(t.cx,t.cy),this.context.closePath(),this}},{key:"drawBow",value:function(t){return this.context.arc(t.cx,t.cy,t.radius,t.aFrom,t.aTo),this.context.closePath(),this}},{key:"drawPolygon",value:function(t){var e,n,i,r;for(r=t.vertices,e=0,n=r.length;e<n;e++)i=r[e],this.context.lineTo(i.x,i.y);return this.context.closePath(),this}},{key:"drawPolyline",value:function(t){var e,n,i,r;for(r=t.vertices,e=0,n=r.length;e<n;e++)i=r[e],this.context.lineTo(i.x,i.y);return this}},{key:"drawSpline",value:function(t){var e,n,i,r;if(null!=t.strokeStyle)if(i=t.vertices.length,2===i)this.context.moveTo(t.vertices[0].x,t.vertices[0].y),this.context.lineTo(t.vertices[1].x,t.vertices[1].y);else if(i>2)for(this.context.moveTo(t.vertices[0].x,t.vertices[0].y),e=n=1,r=i-1;1<=r?n<=r:n>=r;e=1<=r?++n:--n)this.context.bezierCurveTo(t.controlPointsBehind[e-1].x,t.controlPointsBehind[e-1].y,t.controlPointsAhead[e].x,t.controlPointsAhead[e].y,t.vertices[e].x,t.vertices[e].y);return this}},{key:"drawPointText",value:function(t){var e,n,i,r,s,o,a,h,u;if(i=t.font||Bu.DEFAULT_FONT,Bu.isString(i))this.context.textAlign=t.textAlign,this.context.textBaseline=t.textBaseline,this.context.font=i,null!=t.strokeStyle&&this.context.strokeText(t.text,t.x,t.y),null!=t.fillStyle&&(this.context.fillStyle=t.fillStyle,this.context.fillText(t.text,t.x,t.y));else if(i instanceof Bu.SpriteSheet&&i.ready)for(a=i.measureTextWidth(t.text),h=function(){switch(t.textAlign){case"left":return 0;case"center":return-a/2;case"right":return-a}}(),u=function(){switch(t.textBaseline){case"top":return 0;case"middle":return-i.height/2;case"bottom":return-i.height}}(),r=s=0,o=t.text.length;0<=o?s<o:s>o;r=0<=o?++s:--s)e=t.text[r],n=i.getFrameImage(e),null!=n?(this.context.drawImage(n,t.x+h,t.y+u),h+=n.width):h+=10;return this}},{key:"drawImage",value:function(t){var e,n,i,r;return t.ready&&(r=t.size.width,i=t.size.height,e=-r*t.pivot.x,n=-i*t.pivot.y,this.context.drawImage(t.image,e,n,r,i)),this}},{key:"drawBounds",value:function(e){var n;return this.context.beginPath(),this.context.strokeStyle=t.BOUNDS_STROKE_STYLE,"function"==typeof(n=this.context).setLineDash&&n.setLineDash(t.BOUNDS_DASH_STYLE),this.context.rect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1),this.context.stroke(),this}}]),t}();return t.property("imageSmoothing",{get:function(){return this._imageSmoothing},set:function(t){return this._imageSmoothing=this.context.imageSmoothingEnabled=t}}),t}(),T.BOUNDS_STROKE_STYLE="red",T.BOUNDS_DASH_STYLE=[6,6];var B,C=T;B=function(){var t=function(){function t(){var e=this;_classCallCheck(this,t),this.keyStates=[],window.addEventListener("keydown",function(t){return e.keyStates[t.keyCode]=!0}),window.addEventListener("keyup",function(t){return e.keyStates[t.keyCode]=!1})}return _createClass(t,[{key:"isKeyDown",value:function(t){var e;return e=this.keyToKeyCode(t),this.keyStates[e]}},{key:"keyToKeyCode",value:function(t){var e;return t=this.keyAliasToKeyMap[t]||t,e=this.keyToKeyCodeMap[t]}},{key:"handleAppEvents",value:function(t,e){var n,i,r,s,o,a;r={},s={},window.addEventListener("keydown",function(e){var n;return null!=(n=r[e.keyCode])?n.call(t,e):void 0}),window.addEventListener("keyup",function(e){var n;return null!=(n=s[e.keyCode])?n.call(t,e):void 0}),o=[];for(a in e)"mousedown"===a||"mousemove"===a||"mouseup"===a||"mousewheel"===a?o.push(t.$renderer.dom.addEventListener(a,e[a].bind(t))):"keydown"===a||"keyup"===a?o.push(window.addEventListener(a,e[a].bind(t))):0===a.indexOf("keydown.")?(n=a.substring(8),i=this.keyToKeyCode(n),o.push(r[i]=e[a])):0===a.indexOf("keyup.")?(n=a.substring(6),i=this.keyToKeyCode(n),o.push(s[i]=e[a])):o.push(void 0);return o}}]),t}();return t.prototype.keyToKeyCodeMap={Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,CapsLock:20,Escape:27," ":32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Delete:46,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"`":192,"=":187,",":188,"-":189,".":190,"/":191,";":186,"'":222,"[":219,"]":221,"\\":220},t.prototype.keyAliasToKeyMap={Ctrl:"Control",Ctl:"Control",Esc:"Escape",Space:" ",PgUp:"PageUp","Page Up":"PageUp",PgDn:"PageDown","Page Down":"PageDown",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete"},t}();var L,F=B,O={}.hasOwnProperty;L=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var n,i,r,s,o;for(this.$options=e,o=["renderer","data","objects","methods","events"],i=0,s=o.length;i<s;i++)r=o[i],(n=this.$options)[r]||(n[r]={});this.$inputManager=new F,Bu.ready(this.init,this)}return _createClass(t,[{key:"init",value:function(){var t,e,n,i,r,s,o=this,a=arguments;s=new S,s.background=this.$options.background||S.DEFAULT_BACKGROUND,this.$renderer=new C(this.$options.renderer),this.$renderer.scene=s,s.renderer=this.$renderer,Bu.isFunction(this.$options.data)&&(this.$options.data=this.$options.data.apply(this));for(e in this.$options.data)this[e]=this.$options.data[e];for(e in this.$options.methods)this[e]=this.$options.methods[e];i=Bu.isFunction(this.$options.objects)?this.$options.objects.apply(this):this.$options.objects;for(n in i)this[n]=i[n];if(!this.$options.scene){this.$options.scene={};for(n in i)this.$options.scene[n]={}}if(t=function(e,r){var s;s=[];for(n in e)O.call(e,n)&&(r.addChild(i[n]),s.push(t(e[n],i[n])));return s},t(this.$options.scene,this.$renderer.scene),null!=(r=this.$options.init)&&r.call(this),this.$inputManager.handleAppEvents(this,this.$options.events),null!=this.$options.update)return this.$renderer.on("update",function(){return o.$options.update.apply(o,a)})}}]),t}();var A,R=L;A=function(){function t(e){_classCallCheck(this,t),this.audio=document.createElement("audio"),this.url="",this.ready=!1,e&&this.load(e)}return _createClass(t,[{key:"load",value:function(t){var e=this;return this.url=t,this.audio.addEventListener("canplay",function(){return e.ready=!0}),this.audio.src=t}},{key:"play",value:function(){return this.ready?this.audio.play():console.warn("The audio file "+this.url+" hasn't been ready.")}}]),t}();var I,E=A;I=function(){var t=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_classCallCheck(this,e);var r,s=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return s.text=t,s.x=n,s.y=i,s.type="PointText",s.strokeStyle=null,s.fillStyle="black",r=Bu.combineOptions(arguments,{align:"00"}),s.align=r.align,null!=r.font?s.font=r.font:null!=r.fontFamily||null!=r.fontSize?(s._fontFamily=r.fontFamily||Bu.DEFAULT_FONT_FAMILY,
s._fontSize=r.fontSize||Bu.DEFAULT_FONT_SIZE,s.font=s._fontSize+"px "+s._fontFamily):s.font=null,s}return _inherits(e,t),_createClass(e,[{key:"setAlign",value:function(t){var e,n;return 1===t.length&&(t=""+t+t),e=t.substring(0,1),n=t.substring(1,2),this.textAlign=function(){switch(e){case"-":return"right";case"0":return"center";case"+":return"left"}}(),this.textBaseline=function(){switch(n){case"-":return"bottom";case"0":return"middle";case"+":return"top"}}(),this}},{key:"setFontFamily",value:function(t){return this.fontFamily=t,this}},{key:"setFontSize",value:function(t){return this.fontSize=t,this}}]),e}(b);return t.property("align",{get:function(){return this._align},set:function(t){return this._align=t,this.setAlign(this._align)}}),t.property("fontFamily",{get:function(){return this._fontFamily},set:function(t){return this._fontFamily=t,this.font=this._fontSize+"px "+this._fontFamily}}),t.property("fontSize",{get:function(){return this._fontSize},set:function(t){return this._fontSize=t,this.font=this._fontSize+"px "+this._fontFamily}}),t}();var M,D=I;M=function(){var t=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.x=t,i.y=n,i.lineWidth=.5,i._labelIndex=-1,i}return _inherits(e,t),_createClass(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"arcTo",value:function(t,n){return new e(this.x+Math.cos(n)*t,this.y+Math.sin(n)*t)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.updateLabel(),this}},{key:"set",value:function(t,e){return this.x=t,this.y=e,this.updateLabel(),this}},{key:"setLabel",value:function(t){return this.label=t,this.updateLabel(),this}},{key:"updateLabel",value:function(){return this._labelIndex>-1&&(this.children[this._labelIndex].x=this.x+Bu.POINT_LABEL_OFFSET,this.children[this._labelIndex].y=this.y),this}}]),e}(b);return t.prototype.type="Point",t.prototype.fillable=!0,t.property("label",{get:function(){return this._labelIndex>-1?this.children[this._labelIndex].text:""},set:function(t){var e;return this._labelIndex===-1?(e=new D(t,this.x+Bu.POINT_LABEL_OFFSET,this.y,{align:"+0"}),this.children.push(e),this._labelIndex=this.children.length-1):this.children[this._labelIndex].text=t}}),t}();var z,j=M;z=function(){var t=function(t){function e(t,n,i,r){_classCallCheck(this,e);var s=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return arguments.length<2?s.points=[new j,new j]:arguments.length<4?s.points=[t.clone(),n.clone()]:s.points=[new j(t,n),new j(i,r)],s.length=0,s.midpoint=new j,s.keyPoints=s.points,s.on("changed",function(){return s.length=s.points[0].distanceTo(s.points[1]),s.midpoint.set((s.points[0].x+s.points[1].x)/2,(s.points[0].y+s.points[1].y)/2)}),s.trigger("changed"),s}return _inherits(e,t),_createClass(e,[{key:"clone",value:function(){return new e(this.points[0],this.points[1])}},{key:"set",value:function(t,e,n,i){return"undefined"!=typeof p4&&null!==p4?(this.points[0].set(t,e),this.points[1].set(n,i)):(this.points[0]=t,this.points[1]=e),this.trigger("changed"),this}},{key:"setPoint1",value:function(t,e){return null!=e?this.points[0].set(t,e):this.points[0].copy(t),this.trigger("changed"),this}},{key:"setPoint2",value:function(t,e){return null!=e?this.points[1].set(t,e):this.points[1].copy(t),this.trigger("changed"),this}}]),e}(b);return t.prototype.type="Line",t.prototype.fillable=!1,t}();var N,W=z;N=function(){var t=function(t){function e(t,n,i,r,s){_classCallCheck(this,e);var o=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(o.cx=t,o.cy=n,o.radius=i,o.aFrom=r,o.aTo=s,o.aFrom>o.aTo){var a=[o.aTo,o.aFrom];o.aFrom=a[0],o.aTo=a[1]}return o.center=new j(o.cx,o.cy),o.string=new W(o.center.arcTo(o.radius,o.aFrom),o.center.arcTo(o.radius,o.aTo)),o.keyPoints=o.string.points,o.updateKeyPoints(),o.on("changed",o.updateKeyPoints),o.on("changed",function(){var t;return null!=(t=o.bounds)?t.update():void 0}),o}return _inherits(e,t),_createClass(e,[{key:"clone",value:function(){return new e(this.cx,this.cy,this.radius,this.aFrom,this.aTo)}},{key:"updateKeyPoints",value:function(){return this.center.set(this.cx,this.cy),this.string.points[0].copy(this.center.arcTo(this.radius,this.aFrom)),this.string.points[1].copy(this.center.arcTo(this.radius,this.aTo)),this.keyPoints=this.string.points,this}}]),e}(b);return t.prototype.type="Bow",t.prototype.fillable=!0,t}();var Y,U=N;Y=function(){var t=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_classCallCheck(this,e);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._radius=t,r._center=new j(n,i),r.bounds=null,r.keyPoints=[r._center],r.on("centerChanged",r.updateKeyPoints),r}return _inherits(e,t),_createClass(e,[{key:"clone",value:function(){return new e(this.radius,this.cx,this.cy)}},{key:"updateKeyPoints",value:function(){return this.keyPoints[0].set(this.cx,this.cy)}}]),e}(b);return t.prototype.type="Circle",t.prototype.fillable=!0,t.property("cx",{get:function(){return this._center.x},set:function(t){return this._center.x=t,this.trigger("centerChanged",this)}}),t.property("cy",{get:function(){return this._center.y},set:function(t){return this._center.y=t,this.trigger("centerChanged",this)}}),t.property("center",{get:function(){return this._center},set:function(t){return this._center=t,this.cx=t.x,this.cy=t.y,this.keyPoints[0]=t,this.trigger("centerChanged",this)}}),t.property("radius",{get:function(){return this._radius},set:function(t){return this._radius=t,this.trigger("radiusChanged",this),this}}),t}();var X,H=Y;X=function(){var t=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._radiusX=t,i._radiusY=n,i}return _inherits(e,t),e}(b);return t.prototype.type="Ellipse",t.prototype.fillable=!0,t.property("radiusX",{get:function(){return this._radiusX},set:function(t){return this._radiusX=t,this.trigger("changed",this)}}),t.property("radiusY",{get:function(){return this._radiusY},set:function(t){return this._radiusY=t,this.trigger("changed",this)}}),t}();var $,K=X;$=function(){var t=function(t){function e(t,n,i,r,s){_classCallCheck(this,e);var o=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(o.cx=t,o.cy=n,o.radius=i,o.aFrom=r,o.aTo=s,o.aFrom>o.aTo){var a=[o.aTo,o.aFrom];o.aFrom=a[0],o.aTo=a[1]}return o.center=new j(o.cx,o.cy),o.string=new W(o.center.arcTo(o.radius,o.aFrom),o.center.arcTo(o.radius,o.aTo)),o.keyPoints=[o.string.points[0],o.string.points[1],o.center],o.on("changed",o.updateKeyPoints),o.on("changed",function(){var t;return null!=(t=o.bounds)?t.update():void 0}),o}return _inherits(e,t),_createClass(e,[{key:"clone",value:function(){return new e(this.cx,this.cy,this.radius,this.aFrom,this.aTo)}},{key:"updateKeyPoints",value:function(){return this.center.set(this.cx,this.cy),this.string.points[0].copy(this.center.arcTo(this.radius,this.aFrom)),this.string.points[1].copy(this.center.arcTo(this.radius,this.aTo)),this}}]),e}(b);return t.prototype.type="Fan",t.prototype.fillable=!0,t}();var q,G=$;q=function(){var t=function(t){function e(t,n,i){_classCallCheck(this,e);var r,s,o,a,h,u,l=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(6===arguments.length){var c=Array.prototype.slice.call(arguments);r=c[0],a=c[1],s=c[2],h=c[3],o=c[4],u=c[5],t=new j(r,a),n=new j(s,h),i=new j(o,u)}return l.lines=[new W(t,n),new W(n,i),new W(i,t)],l.points=[t,n,i],l.keyPoints=l.points,l.on("changed",l.update),l.on("changed",function(){var t;return null!=(t=l.bounds)?t.update():void 0}),l}return _inherits(e,t),_createClass(e,[{key:"clone",value:function(){return new e(this.points[0],this.points[1],this.points[2])}},{key:"update",value:function(){return this.lines[0].points[0].copy(this.points[0]),this.lines[0].points[1].copy(this.points[1]),this.lines[1].points[0].copy(this.points[1]),this.lines[1].points[1].copy(this.points[2]),this.lines[2].points[0].copy(this.points[2]),this.lines[2].points[1].copy(this.points[0])}}]),e}(b);return t.prototype.type="Triangle",t.prototype.fillable=!0,t}();var V,J=q;V=function(){var t=function(t){function e(t){_classCallCheck(this,e);var n,i,r,s,o,a=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a.vertices=[],a.lines=[],a.triangles=[],i=Bu.combineOptions(arguments,{angle:0}),Bu.isArray(t)?null!=t&&(a.vertices=t):(arguments.length<4?(s=0,o=0,r=arguments[0],n=arguments[1]):(s=arguments[0],o=arguments[1],r=arguments[2],n=arguments[3]),a.vertices=e.generateRegularPoints(s,o,r,n,i)),a.onVerticesChanged(),a.on("changed",a.onVerticesChanged),a.on("changed",function(){var t;return null!=(t=a.bounds)?t.update():void 0}),a.keyPoints=a.vertices,a}return _inherits(e,t),_createClass(e,[{key:"clone",value:function(){return new e(this.vertices)}},{key:"onVerticesChanged",value:function(){var t,e,n,i,r,s;if(this.lines=[],this.triangles=[],this.vertices.length>1){for(t=e=0,i=this.vertices.length-1;0<=i?e<i:e>i;t=0<=i?++e:--e)this.lines.push(new W(this.vertices[t],this.vertices[t+1]));this.lines.push(new W(this.vertices[this.vertices.length-1],this.vertices[0]))}if(this.vertices.length>2){for(s=[],t=n=1,r=this.vertices.length-1;1<=r?n<r:n>r;t=1<=r?++n:--n)s.push(this.triangles.push(new J(this.vertices[0],this.vertices[t],this.vertices[t+1])));return s}}},{key:"isSimple",value:function(){var t,e,n,i,r,s,o,a;for(r=this.lines.length,t=n=0,s=r;0<=s?n<s:n>s;t=0<=s?++n:--n)for(e=i=o=t+1,a=r;o<=a?i<a:i>a;e=o<=a?++i:--i)if(this.lines[t].isCrossWithLine(this.lines[e]))return!1;return!0}},{key:"addPoint",value:function(t,e){return null!=e?this.vertices.splice(e,0,t):(this.vertices.push(t),this.vertices.length>1&&(this.lines[this.lines.length-1].points[1]=t),this.vertices.length>0&&this.lines.push(new W(this.vertices[this.vertices.length-1],this.vertices[0])),this.vertices.length>2?this.triangles.push(new J(this.vertices[0],this.vertices[this.vertices.length-2],this.vertices[this.vertices.length-1])):void 0)}}],[{key:"generateRegularPoints",value:function(t,e,n,i,r){var s,o,a,h,u,l,c,p,d,y;for(o=r.angle,c=n,l=[],a=Bu.TWO_PI/i,h=u=0,p=i;0<=p?u<p:u>p;h=0<=p?++u:--u)s=h*a+o,d=t+c*Math.cos(s),y=e+c*Math.sin(s),l[h]=new j(d,y);return l}}]),e}(b);return t.prototype.type="Polygon",t.prototype.fillable=!0,t}();var Z,Q=V;Z=function(){var t=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];_classCallCheck(this,e);var n,i,r,s,o=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(o.vertices=t,arguments.length>1){for(s=[],n=i=0,r=arguments.length/2;0<=r?i<r:i>r;n=0<=r?++i:--i)s.push(new j(arguments[2*n],arguments[2*n+1]));o.vertices=s}return o.lines=[],o.keyPoints=o.vertices,o.fill(!1),o.on("changed",function(){if(o.vertices.length>1)return o.updateLines(),"function"==typeof o.calcLength&&o.calcLength(),"function"==typeof o.calcPointNormalizedPos?o.calcPointNormalizedPos():void 0}),o.trigger("changed"),o}return _inherits(e,t),_createClass(e,[{key:"clone",value:function(){var t;return t=new e(this.vertices),t.strokeStyle=this.strokeStyle,t.fillStyle=this.fillStyle,t.dashStyle=this.dashStyle,t.lineWidth=this.lineWidth,t.dashOffset=this.dashOffset,t}},{key:"updateLines",value:function(){var t,e,n;for(t=e=0,n=this.vertices.length-1;0<=n?e<n:e>n;t=0<=n?++e:--e)null!=this.lines[t]?this.lines[t].set(this.vertices[t],this.vertices[t+1]):this.lines[t]=new W(this.vertices[t],this.vertices[t+1]);return this}},{key:"addPoint",value:function(t,e){return null==e?(this.vertices.push(t),this.vertices.length>1&&this.lines.push(new W(this.vertices[this.vertices.length-2],this.vertices[this.vertices.length-1]))):this.vertices.splice(e,0,t),this.trigger("changed"),this}}]),e}(b);return t.prototype.type="Polyline",t.prototype.fillable=!1,t}();var tt,et=Z;tt=function(){var t=function(t){function e(t,n,i,r){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;_classCallCheck(this,e);var o=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o.center=new j(t+i/2,n+r/2),o.size=new f(i,r),o.pointLT=new j(t,n),o.pointRT=new j(t+i,n),o.pointRB=new j(t+i,n+r),o.pointLB=new j(t,n+r),o.points=[o.pointLT,o.pointRT,o.pointRB,o.pointLB],o.cornerRadius=s,o.on("changed",function(){var t;return null!=(t=o.bounds)?t.update():void 0}),o}return _inherits(e,t),_createClass(e,[{key:"clone",value:function(){return new e(this.pointLT.x,this.pointLT.y,this.size.width,this.size.height)}},{key:"set",value:function(t,e,n,i){return this.center.set(t+n/2,e+i/2),this.size.set(n,i),this.pointLT.set(t,e),this.pointRT.set(t+n,e),this.pointRB.set(t+n,e+i),this.pointLB.set(t,e+i)}}]),e}(b);return t.prototype.type="Rectangle",t.prototype.fillable=!0,t.property("cornerRadius",{get:function(){return this._cornerRadius},set:function(t){return this._cornerRadius=t,this.keyPoints=t>0?[]:this.points}}),t}();var nt,it=tt;nt=function(){var t,e=function(e){function n(e){_classCallCheck(this,n);var i,r=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e instanceof et?(i=e,r.vertices=i.vertices,i.on("pointChange",function(e){return r.vertices=e.vertices,t(r)})):r.vertices=Bu.clone(e),r.keyPoints=r.vertices,r.controlPointsAhead=[],r.controlPointsBehind=[],r.fill(!1),r.smoothFactor=Bu.DEFAULT_SPLINE_SMOOTH,r._smoother=!1,t(r),r}return _inherits(n,e),_createClass(n,[{key:"clone",value:function(){return new n(this.vertices)}},{key:"addPoint",value:function(e){return this.vertices.push(e),t(this)}}]),n}(b);return e.prototype.type="Spline",e.prototype.fillable=!1,e.property("smoother",{get:function(){return this._smoother},set:function(e){var n;if(n=this._smoother,this._smoother=e,n!==this._smoother)return t(this)}}),t=function(t){var e,n,i,r,s,o,a,h,u,l,c,p,d,y,f;if(t.keyPoints=t.vertices,o=t.vertices,i=o.length,i>=1&&(t.controlPointsBehind[0]=o[0]),i>=2&&(t.controlPointsAhead[i-1]=o[i-1]),i>=3){for(h=[],e=n=1,a=i-1;1<=a?n<a:n>a;e=1<=a?++n:--n)l=Math.atan2(o[e].y-o[e-1].y,o[e].x-o[e-1].x),c=Math.atan2(o[e+1].y-o[e].y,o[e+1].x-o[e].x),r=Bu.bevel(o[e].y-o[e-1].y,o[e].x-o[e-1].x),s=Bu.bevel(o[e].y-o[e+1].y,o[e].x-o[e+1].x),u=l+(c-l)*(t._smoother?r/(r+s):.5),Math.abs(u-l)>Bu.HALF_PI&&(u+=Math.PI),p=o[e].x-r*t.smoothFactor*Math.cos(u),y=o[e].y-r*t.smoothFactor*Math.sin(u),d=o[e].x+s*t.smoothFactor*Math.cos(u),f=o[e].y+s*t.smoothFactor*Math.sin(u),t.controlPointsAhead[e]=new j(p,y),h.push(t.controlPointsBehind[e]=new j(d,f));return h}},e}();var rt,st=nt;rt=function(){var t=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments[3],s=arguments[4];_classCallCheck(this,e);var o=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o.url=t,o.type="Image",o.autoSize=!0,o.size=new f,o.position=new u(n,i),o.center=new u(n+r/2,i+s/2),null!=r&&(o.size.set(r,s),o.autoSize=!1),o.pivot=new u(.5,.5),o._image=new Bu.global.Image,o.ready=!1,o._image.onload=function(t){return o.autoSize&&o.size.set(o._image.width,o._image.height),o.ready=!0},null!=o.url&&(o._image.src=o.url),o}return _inherits(e,t),e}(b);return t.property("image",{get:function(){return this._image},set:function(t){return this._image=t,this.ready=!0}}),t}();var ot,at=rt,ht={}.hasOwnProperty;ot=function(){var t,e,n,i=function(){function i(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];_classCallCheck(this,i),this.animation=t,this.target=e,this.args=n,this.startTime=0,this.finished=!1,this.from=Bu.clone(this.animation.from),this.current=Bu.clone(this.animation.from),this.to=Bu.clone(this.animation.to),this.data={},this.t=0,this.arg=this.args[0]}return _createClass(i,[{key:"init",value:function(){var t;return null!=(t=this.animation.init)&&t.call(this.target,this),this.current=Bu.clone(this.from)}},{key:"restart",value:function(){return this.startTime=Bu.now(),this.finished=!1}},{key:"end",value:function(){return this.startTime=Bu.now()-1e3*this.animation.duration}},{key:"interpolate",value:function(){var i,r,s;if(null!=this.from){if(Bu.isNumber(this.from))return this.current=e(this.from,this.to,this.t);if(this.from instanceof d)return t(this.from,this.to,this.t,this.current);if(this.from instanceof u)return n(this.from,this.to,this.t,this.current);if(Bu.isPlainObject(this.from)){r=this.from,s=[];for(i in r)ht.call(r,i)&&(Bu.isNumber(this.from[i])?s.push(this.current[i]=e(this.from[i],this.to[i],this.t)):s.push(interpolateObject(this.from[i],this.to[i],this.t,this.current[i])));return s}return console.error("Animation not support interpolate type: ",this.from)}}}]),i}();return e=function(t,e,n){return e*n-t*(n-1)},t=function(t,n,i,r){return r.setRGBA(e(t.r,n.r,i),e(t.g,n.g,i),e(t.b,n.b,i),e(t.a,n.a,i))},n=function(t,n,i,r){return r.x=e(t.x,n.x,i),r.y=e(t.y,n.y,i)},i}();var ut,lt=ot,ct={}.hasOwnProperty;ut=function(){function t(e){_classCallCheck(this,t),this.from=e.from,this.to=e.to,this.duration=e.duration||.5,this.easing=e.easing||!1,this.repeat=!!e.repeat,this.init=e.init,this.update=e.update,this.finish=e.finish}return _createClass(t,[{key:"applyTo",value:function(t,e){var n;return Bu.isArray(e)||(e=[e]),n=new lt(this,t,e),Bu.animationRunner.add(n),n}},{key:"isLegal",value:function(){var t,e;if(null==this.from||null==this.to)return!0;if(Bu.isPlainObject(this.from)){e=this.from;for(t in e)if(ct.call(e,t)&&null==this.to[t])return!1}else if(null==this.to)return!1;return!0}}]),t}(),Bu.animations={fadeIn:new ut({update:function(t){return this.opacity=t.t}}),fadeOut:new ut({update:function(t){return this.opacity=1-t.t}}),spin:new ut({update:function(t){return this.rotation=t.t*Math.PI*2}}),spinIn:new ut({init:function(t){return t.data.desScale=t.arg||1},update:function(t){return this.opacity=t.t,this.rotation=t.t*Math.PI*4,this.scale=t.t*t.data.desScale}}),spinOut:new ut({update:function(t){return this.opacity=1-t.t,this.rotation=t.t*Math.PI*4,this.scale=1-t.t}}),blink:new ut({duration:.2,from:0,to:512,update:function(t){var e;return e=Math.floor(Math.abs(t.current-256)),this.fillStyle="rgb("+e+", "+e+", "+e+")"}}),shake:new ut({init:function(t){return t.data.ox=this.position.x,t.data.range=t.arg||20},update:function(t){return this.position.x=Math.sin(t.t*Math.PI*8)*t.data.range+t.data.ox}}),jump:new ut({init:function(t){return t.data.oy=this.position.y,t.data.height=t.arg||100},update:function(t){return this.position.y=-t.data.height*Math.sin(t.t*Math.PI)+t.data.oy}}),puff:new ut({duration:.15,init:function(t){return t.from={opacity:this.opacity,scale:this.scale.x},t.to=1===this.opacity?{opacity:0,scale:1.5*this.scale.x}:{opacity:1,scale:this.scale.x/1.5}},update:function(t){return this.opacity=t.current.opacity,this.scale=t.current.scale}}),clip:new ut({init:function(t){return 0!==this.scale.y?(t.from=this.scale.y,t.to=0):(t.from=this.scale.y,t.to=this.scale.x)},update:function(t){return this.scale.y=t.current}}),flipX:new ut({init:function(t){return t.from=this.scale.x,t.to=-t.from},update:function(t){return this.scale.x=t.current}}),flipY:new ut({init:function(t){return t.from=this.scale.y,t.to=-t.from},update:function(t){return this.scale.y=t.current}}),moveTo:new ut({init:function(t){return null!=t.arg?(t.from=this.position.x,t.to=parseFloat(t.arg)):console.error("Bu.animations.moveTo need an argument")},update:function(t){return this.position.x=t.current}}),moveBy:new ut({init:function(t){return null!=t.args?(t.from=this.position.x,t.to=this.position.x+parseFloat(t.args)):console.error("Bu.animations.moveBy need an argument")},update:function(t){return this.position.x=t.current}}),discolor:new ut({init:function(t){var e;return e=t.arg,Bu.isString(e)&&(e=new d(e)),t.from=new d(this.fillStyle),t.to=e},update:function(t){return this.fillStyle=t.current.toRGBA()}})};var pt,dt=ut;pt=function(){var t,e,n=function(){function n(){_classCallCheck(this,n),this.runningAnimations=[]}return _createClass(n,[{key:"add",value:function(t){return t.init(),t.animation.isLegal()?(t.startTime=Bu.now(),this.runningAnimations.push(t)):console.error("AnimationRunner: animation setting is illegal: ",t.animation)}},{key:"update",value:function(){var n,i,r,s,o,a,h,u,l,c;for(o=Bu.now(),a=this.runningAnimations,u=[],r=0,s=a.length;r<s;r++)c=a[r],c.finished||(n=c.animation,l=(o-c.startTime)/(1e3*n.duration),l>=1&&(i=!0,n.repeat?(l=0,c.startTime=Bu.now()):(l=1,c.finished=!0)),n.easing===!0?l=e[t](l):null!=e[n.easing]&&(l=e[n.easing](l)),c.t=l,c.interpolate(),n.update.call(c.target,c),i?u.push(null!=(h=n.finish)?h.call(c.target,c):void 0):u.push(void 0));return u}},{key:"hookUp",value:function(t){var e=this;return t.on("update",function(){return e.update()})}}]),n}();return t="quad",e={quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quad:function(t){return t<.5?2*t*t:-2*t*t+4*t-1},cubicIn:function(t){return Math.pow(t,3)},cubicOut:function(t){return Math.pow(t-1,3)+1},cubic:function(t){return t<.5?4*Math.pow(t,3):4*Math.pow(t-1,3)+1},sineIn:function(t){return Math.sin((t-1)*Bu.HALF_PI)+1},sineOut:function(t){return Math.sin(t*Bu.HALF_PI)},sine:function(t){return t<.5?(Math.sin((2*t-1)*Bu.HALF_PI)+1)/2:Math.sin((t-.5)*Math.PI)/2+.5}},n}(),Bu.animationRunner=new pt;var yt,ft=pt;yt=function(){function t(){_classCallCheck(this,t),this.flowingObjects=[]}return _createClass(t,[{key:"setSpeed",value:function(t,e){var n;if(t.dashFlowSpeed=e,n=this.flowingObjects.indexOf(t),0!==e){if(n===-1)return this.flowingObjects.push(t)}else if(n>-1)return this.flowingObjects.splice(n,1)}},{key:"update",value:function(){var t,e,n,i,r;for(i=this.flowingObjects,r=[],t=0,e=i.length;t<e;t++)n=i[t],r.push(n.dashOffset+=n.dashFlowSpeed);return r}},{key:"hookUp",value:function(t){var e=this;return t.on("update",function(){return e.update()})}}]),t}(),Bu.dashFlowManager=new yt;var gt,vt,mt=yt,xt={}.hasOwnProperty;vt=function(t,e){var n;return e||("object"===("undefined"==typeof t?"undefined":_typeof(t))?(e=t,t=e.url):e={}),e.method||(e.method="GET"),null==e.async&&(e.async=!0),n=new XMLHttpRequest,n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){if(null!=e.success)return e.success(n.responseText,n.status,n)}else if(null!=e.error&&e.error(n,n.status),null!=e.complete)return e.complete(n,n.status)},n.open(e.method,t,e.async,e.username,e.password),n.send(null)},gt=function(){var t,e,n,i=function(){function t(e){var n=this;_classCallCheck(this,t),this.url=e,v.apply(this),this.ready=!1,this.height=0,this.data=null,this.images=[],this.frameImages=[],vt(this.url,{success:function(t){var e,i,r,s,o;n.data=JSON.parse(t),null==n.data.images&&(n.data.images=[n.url.substring(n.url.lastIndexOf("/"),n.url.length-5)+".png"]),e=n.url.substring(0,n.url.lastIndexOf("/")+1),s=n.data.images,o=[];for(r in s)xt.call(s,r)&&(n.data.images[r]=e+n.data.images[r],i=0,n.images[r]=new Image,n.images[r].onload=function(){if(i+=1,i===n.data.images.length)return n.parseData()},o.push(n.images[r].src=n.data.images[r]));return o}})}return _createClass(t,[{key:"parseData",value:function(){var t,n,i,r,s,o,a,h,u,l;n=this.data.frames;for(r in n)if(xt.call(n,r)){for(s=o=0;o<=4;s=++o)null==n[r][s]&&(n[r][s]=null!=(null!=(a=n[r-1])?a[s]:void 0)?n[r-1][s]:0);u=n[r][0],l=n[r][1],h=n[r][2],i=n[r][3],t=n[r][4],this.frameImages[r]=e(this.images[t],u,l,h,i),0===this.height&&(this.height=i)}return this.ready=!0,this.trigger("loaded")}},{key:"getFrameImage",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.ready?(e=this.data.animations[t],null==e?null:this.frameImages[e.frames[n]]):null}},{key:"measureTextWidth",value:function(t){var e,n,i,r;for(r=0,n=0,i=t.length;n<i;n++)e=t[n],r+=this.getFrameImage(e).width;return r}}]),t}();return t=document.createElement("canvas"),n=t.getContext("2d"),e=function(e,i,r,s,o){var a;return t.width=s,t.height=o,n.drawImage(e,i,r,s,o,0,0,s,o),a=new Image,a.src=t.toDataURL(),a},i}();var wt,_t=gt;wt=function(){var t,e,n=function(){function n(i,r){_classCallCheck(this,n),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),this.camera=i,this.zoomScaleAnim=t.applyTo(this.camera),this.zoomTransAnim=e.applyTo(this.camera),this.smoothZooming=!0,this.desScale=new u(1,1),r.addEventListener("mousemove",this.onMouseMove),r.addEventListener("mousewheel",this.onMouseWheel)}return _createClass(n,[{key:"onMouseMove",value:function(t){var e,n,i;if(t.buttons===Bu.MOUSE.LEFT)return i=this.camera.scale.x,e=-t.movementX*i,n=-t.movementY*i,this.camera.translate(e,n)}},{key:"onMouseWheel",value:function(t){var e,n,i,r,s,o,a;return n=Math.pow(1.25,-t.wheelDelta/120),this.desScale.multiplyScalar(n),e=this.desScale.x/this.camera.scale.x,a=getComputedStyle(t.target),s=t.offsetX-parseFloat(a.width)/2,o=t.offsetY-parseFloat(a.height)/2,i=-s*(e-1)*this.camera.scale.x,r=-o*(e-1)*this.camera.scale.y,this.smoothZooming?(this.zoomScaleAnim.from.copy(this.camera.scale),this.zoomScaleAnim.to.copy(this.desScale),this.zoomScaleAnim.restart(),this.zoomTransAnim.from.copy(this.camera.position),this.zoomTransAnim.to.set(this.camera.position.x+i,this.camera.position.y+r),this.zoomTransAnim.restart()):(this.camera.translate(i,r),this.camera.scale.copy(this.desScale))}}]),n}();return t=new dt({duration:.2,init:function(t){return null==t.arg&&(t.arg=1),t.from=this.scale.clone(),t.to=this.scale.clone().multiplyScalar(parseFloat(t.arg))},update:function(t){return this.scale=t.current}}),e=new dt({duration:.2,init:function(t){return null==t.arg&&(t.arg=new u),t.from=this.position.clone(),t.to=this.position.clone().add(t.arg)},update:function(t){return this.position.copy(t.current)}}),n}();var bt,kt,Pt=wt,Tt=[].indexOf,St={}.hasOwnProperty;kt=bt={inject:function(){return this.injectInto(["point","line","circle","ellipse","triangle","rectangle","fan","bow","polygon","polyline"])},injectInto:function(t){if(Bu.isString(t)&&(t=[t]),Tt.call(t,"point")>=0&&(j.prototype.inCircle=function(t){return bt.pointInCircle(this,t)},j.prototype.distanceTo=function(t){return bt.distanceFromPointToPoint(this,t)},j.prototype.isNear=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Bu.DEFAULT_NEAR_DIST;switch(t.type){case"Point":return bt.pointNearPoint(this,t,e);case"Line":return bt.pointNearLine(this,t,e);case"Polyline":return bt.pointNearPolyline(this,t,e)}},j.interpolate=bt.interpolateBetweenTwoPoints),Tt.call(t,"line")>=0&&(W.prototype.distanceTo=function(t){return bt.distanceFromPointToLine(t,this)},W.prototype.isTwoPointsSameSide=function(t,e){return bt.twoPointsSameSideOfLine(t,e,this)},W.prototype.footPointFrom=function(t,e){return bt.footPointFromPointToLine(t,this,e)},W.prototype.getCrossPointWith=function(t){return bt.getCrossPointOfTwoLines(t,this)},W.prototype.isCrossWithLine=function(t){return bt.isTwoLinesCross(t,this)},it.prototype.intersectRect=function(t){return bt.isLineIntersectRect(this,t)}),Tt.call(t,"circle")>=0&&(H.prototype._containsPoint=function(t){return bt.pointInCircle(t,this)}),Tt.call(t,"ellipse")>=0&&(K.prototype._containsPoint=function(t){return bt.pointInEllipse(t,this)}),Tt.call(t,"triangle")>=0&&(J.prototype._containsPoint=function(t){return bt.pointInTriangle(t,this)},J.prototype.area=function(){return bt.calcTriangleArea(this)}),Tt.call(t,"rectangle")>=0&&(it.prototype.containsPoint=function(t){return bt.pointInRectangle(t,this)},it.prototype.intersectLine=function(t){return bt.isLineIntersectRect(t,this)}),Tt.call(t,"fan")>=0&&(G.prototype._containsPoint=function(t){return bt.pointInFan(t,this)}),Tt.call(t,"bow")>=0&&(U.prototype._containsPoint=function(t){return bt.pointInBow(t,this)}),Tt.call(t,"polygon")>=0&&(Q.prototype._containsPoint=function(t){return bt.pointInPolygon(t,this)}),Tt.call(t,"polyline")>=0)return et.prototype.length=0,et.prototype.pointNormalizedPos=[],et.prototype.calcLength=function(){return this.length=bt.calcPolylineLength(this)},et.prototype.calcPointNormalizedPos=function(){return bt.calcNormalizedVerticesPosOfPolyline(this)},et.prototype.getNormalizedPos=function(t){return null!=t?this.pointNormalizedPos[t]:this.pointNormalizedPos},et.prototype.compress=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.8;return bt.compressPolyline(this,t)}},pointNearPoint:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Bu.DEFAULT_NEAR_DIST;return t.distanceTo(e)<n},pointNearLine:function(t,e){var n,i,r,s,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Bu.DEFAULT_NEAR_DIST;return s=e.distanceTo(t),n=e.footPointFrom(t),i=n.distanceTo(e.points[0])<e.length+o,r=n.distanceTo(e.points[1])<e.length+o,s<o&&i&&r},pointNearPolyline:function(t,e){var n,i,r,s,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Bu.DEFAULT_NEAR_DIST;for(s=e.lines,n=0,i=s.length;n<i;n++)if(r=s[n],bt.pointNearLine(t,r,o))return!0;return!1},pointInCircle:function(t,e){var n,i;return n=t.x-e.cx,i=t.y-e.cy,Bu.bevel(n,i)<e.radius},pointInEllipse:function(t,e){return Bu.bevel(t.x/e.radiusX,t.y/e.radiusY)<1},pointInRectangle:function(t,e){return t.x>e.pointLT.x&&t.y>e.pointLT.y&&t.x<e.pointLT.x+e.size.width&&t.y<e.pointLT.y+e.size.height},pointInTriangle:function(t,e){return bt.twoPointsSameSideOfLine(t,e.points[2],e.lines[0])&&bt.twoPointsSameSideOfLine(t,e.points[0],e.lines[1])&&bt.twoPointsSameSideOfLine(t,e.points[1],e.lines[2])},pointInFan:function(t,e){var n,i,r;for(i=t.x-e.cx,r=t.y-e.cy,n=Math.atan2(t.y-e.cy,t.x-e.cx);n<e.aFrom;)n+=Bu.TWO_PI;return Bu.bevel(i,r)<e.radius&&n>e.aFrom&&n<e.aTo},pointInBow:function(t,e){var n,i;return Bu.bevel(e.cx-t.x,e.cy-t.y)<e.radius&&(n=e.string.isTwoPointsSameSide(e.center,t),i=e.aTo-e.aFrom<Math.PI,n^i)},pointInPolygon:function(t,e){var n,i,r,s;for(r=e.triangles,n=0,i=r.length;n<i;n++)if(s=r[n],s.containsPoint(t))return!0;return!1},distanceFromPointToPoint:function(t,e){return Bu.bevel(t.x-e.x,t.y-e.y)},distanceFromPointToLine:function(t,e){var n,i,r,s;return r=e.points[0],s=e.points[1],n=(r.y-s.y)/(r.x-s.x),i=r.y-n*r.x,Math.abs(n*t.x+i-t.y)/Math.sqrt(n*n+1)},interpolateBetweenTwoPoints:function(t,e,n,i){var r,s;return r=t.x+(e.x-t.x)*n,s=t.y+(e.y-t.y)*n,null!=i?i.set(r,s):new j(r,s)},twoPointsSameSideOfLine:function(t,e,n){var i,r,s,o;return i=n.points[0],r=n.points[1],i.x===r.x?(t.x-i.x)*(e.x-i.x)>0:(s=(i.y-r.y)*(t.x-i.x)/(i.x-r.x)+i.y,o=(i.y-r.y)*(e.x-i.x)/(i.x-r.x)+i.y,(t.y-s)*(e.y-o)>0)},footPointFromPointToLine:function(t,e){var n,i,r,s,o,a,h,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j;return s=e.points[0],o=e.points[1],n=(s.y-o.y)/(s.x-o.x),i=s.y-n*s.x,r=t.x+n*t.y,a=(r-n*i)/(n*n+1),h=n*a+i,u.set(a,h),u},getCrossPointOfTwoLines:function(t,e){var n,i,r,s,o,a,h,u,l,c,p,d=_slicedToArray(t.points,2);u=d[0],l=d[1];var y=_slicedToArray(e.points,2);return c=y[0],p=y[1],n=l.y-u.y,r=u.x-l.x,o=n*u.x+r*u.y,i=p.y-c.y,s=c.x-p.x,a=i*c.x+s*c.y,h=n*s-i*r,new j((s*o-r*a)/h,(n*a-i*o)/h)},isTwoLinesCross:function(t,e){var n,i,r,s,o,a,h,u,l,c,p;return r=t.points[0].x,u=t.points[0].y,s=t.points[1].x,l=t.points[1].y,o=e.points[0].x,c=e.points[0].y,a=e.points[1].x,p=e.points[1].y,n=(l-u)*(a-o)-(p-c)*(s-r),0!==n&&(i=((s-r)*(a-o)*(c-u)+(l-u)*(a-o)*r-(p-c)*(s-r)*o)/n,h=((l-u)*(p-c)*(o-r)+(s-r)*(p-c)*u-(a-o)*(l-u)*c)/-n,(i-r)*(i-s)<=0&&(i-o)*(i-a)<=0&&(h-u)*(h-l)<=0&&(h-c)*(h-p)<=0)},isLineIntersectRect:function(t,e){var n;return n=[new W,new W,new W,new W],n[0].set(e.points[0],e.points[1]),n[1].set(e.points[1],e.points[2]),n[2].set(e.points[2],e.points[3]),n[3].set(e.points[3],e.points[0]),
bt.isTwoLinesCross(t,n[0])||bt.isTwoLinesCross(t,n[1])||bt.isTwoLinesCross(t,n[2])||bt.isTwoLinesCross(t,n[3])},calcPolylineLength:function(t){var e,n,i,r;if(i=0,t.vertices.length>=2)for(e=n=1,r=t.vertices.length;1<=r?n<r:n>r;e=1<=r?++n:--n)i+=t.vertices[e].distanceTo(t.vertices[e-1]);return i},calcNormalizedVerticesPosOfPolyline:function(t){var e,n,i,r,s;for(e=0,t.pointNormalizedPos[0]=0,s=[],n=i=1,r=t.vertices.length;1<=r?i<r:i>r;n=1<=r?++i:--i)e+=t.vertices[n].distanceTo(t.vertices[n-1])/t.length,s.push(t.pointNormalizedPos[n]=e);return s},compressPolyline:function(t,e){var n,i,r,s,o,a,h;n=[],h=t.vertices;for(i in h)if(St.call(h,i))if(i<2)n[i]=t.vertices[i];else{var u=n.slice(-2),l=_slicedToArray(u,2);s=l[0],a=l[1],o=t.vertices[i],r=Math.abs(Math.atan2(s.y-a.y,s.x-a.x)-Math.atan2(a.y-o.y,a.x-o.x)),r<e*e*Bu.HALF_PI?n[n.length-1]=o:n.push(o)}return t.vertices=n,t.keyPoints=t.vertices,t},calcTriangleArea:function(t){var e,n,i,r=_slicedToArray(t.points,3);return e=r[0],n=r[1],i=r[2],Math.abs((n.x-e.x)*(i.y-e.y)-(i.x-e.x)*(n.y-e.y))/2}},bt.inject();var Bt,Ct=kt;Bt=function(){var t,e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"randomX",value:function(){return Bu.rand(this.rangeX+t,this.rangeX+this.rangeWidth-2*t)}},{key:"randomY",value:function(){return Bu.rand(this.rangeY+t,this.rangeY+this.rangeHeight-2*t)}},{key:"randomRadius",value:function(){return Bu.rand(10,Math.min(this.rangeX+this.rangeWidth,this.rangeY+this.rangeHeight)/2)}},{key:"setRange",value:function(t,e,n,i){return null!=n?(this.rangeX=t,this.rangeY=e,this.rangeWidth=n,this.rangeHeight=i):(this.rangeWidth=t,this.rangeHeight=e),this}},{key:"generate",value:function(t){switch(t){case"circle":return this.generateCircle();case"bow":return this.generateBow();case"triangle":return this.generateTriangle();case"rectangle":return this.generateRectangle();case"fan":return this.generateFan();case"polygon":return this.generatePolygon();case"line":return this.generateLine();case"polyline":return this.generatePolyline();default:return console.warn("not support shape: "+t)}}},{key:"randomize",value:function(t){var e,n,i;if(Bu.isArray(t))for(e=0,n=t.length;e<n;e++)i=t[e],this.randomize(i);else switch(t.type){case"Circle":this.randomizeCircle(t);break;case"Ellipse":this.randomizeEllipse(t);break;case"Bow":this.randomizeBow(t);break;case"Triangle":this.randomizeTriangle(t);break;case"Rectangle":this.randomizeRectangle(t);break;case"Fan":this.randomizeFan(t);break;case"Polygon":this.randomizePolygon(t);break;case"Line":this.randomizeLine(t);break;case"Polyline":this.randomizePolyline(t);break;default:console.warn("not support shape: "+t.type)}return this}},{key:"randomizePosition",value:function(t){return t.position.x=this.randomX(),t.position.y=this.randomY(),t.trigger("changed"),this}},{key:"generateCircle",value:function(){var t;return t=new H(this.randomRadius(),this.randomX(),this.randomY()),t.center.label="O",t}},{key:"randomizeCircle",value:function(t){return t.cx=this.randomX(),t.cy=this.randomY(),t.radius=this.randomRadius(),this}},{key:"generateEllipse",value:function(){var t;return t=new K(this.randomRadius(),this.randomRadius()),this.randomizePosition(t),t}},{key:"randomizeEllipse",value:function(t){return t.radiusX=this.randomRadius(),t.radiusY=this.randomRadius(),this.randomizePosition(t),this}},{key:"generateBow",value:function(){var t,e,n;return t=Bu.rand(Bu.TWO_PI),e=t+Bu.rand(Bu.HALF_PI,Bu.TWO_PI),n=new U(this.randomX(),this.randomY(),this.randomRadius(),t,e),n.string.points[0].label="A",n.string.points[1].label="B",n}},{key:"randomizeBow",value:function(t){var e,n;return e=Bu.rand(Bu.TWO_PI),n=e+Bu.rand(Bu.HALF_PI,Bu.TWO_PI),t.cx=this.randomX(),t.cy=this.randomY(),t.radius=this.randomRadius(),t.aFrom=e,t.aTo=n,t.trigger("changed"),this}},{key:"generateFan",value:function(){var t,e,n;return t=Bu.rand(Bu.TWO_PI),e=t+Bu.rand(Bu.HALF_PI,Bu.TWO_PI),n=new G(this.randomX(),this.randomY(),this.randomRadius(),t,e),n.center.label="O",n.string.points[0].label="A",n.string.points[1].label="B",n}},{key:"generateTriangle",value:function(){var t,e,n,i;for(n=[],t=e=0;e<=2;t=++e)n[t]=new j(this.randomX(),this.randomY());return i=new J(n[0],n[1],n[2]),i.points[0].label="A",i.points[1].label="B",i.points[2].label="C",i}},{key:"randomizeTriangle",value:function(t){var e,n;for(e=n=0;n<=2;e=++n)t.points[e].set(this.randomX(),this.randomY());return t.trigger("changed"),this}},{key:"generateRectangle",value:function(){var t;return t=new it(Bu.rand(this.rangeX+this.rangeWidth),Bu.rand(this.rangeY+this.rangeHeight),Bu.rand(this.rangeWidth/2),Bu.rand(this.rangeHeight/2)),t.pointLT.label="A",t.pointRT.label="B",t.pointRB.label="C",t.pointLB.label="D",t}},{key:"randomizeRectangle",value:function(t){return t.set(this.randomX(),this.randomY(),this.randomRadius(),this.randomRadius()),t.trigger("changed"),this}},{key:"generatePolygon",value:function(){var t,e,n,i;for(i=[],t=e=0;e<=3;t=++e)n=new j(this.randomX(),this.randomY()),n.label="P"+t,i.push(n);return new Q(i)}},{key:"randomizePolygon",value:function(t){var e,n,i,r;for(i=t.vertices,e=0,n=i.length;e<n;e++)r=i[e],r.set(this.randomX(),this.randomY());return t.trigger("changed"),this}},{key:"generateLine",value:function(){var t;return t=new W(this.randomX(),this.randomY(),this.randomX(),this.randomY()),t.points[0].label="A",t.points[1].label="B",t}},{key:"randomizeLine",value:function(t){var e,n,i,r;for(r=t.points,e=0,n=r.length;e<n;e++)i=r[e],i.set(this.randomX(),this.randomY());return t.trigger("changed"),this}},{key:"generatePolyline",value:function(){var t,e,n,i;for(i=new et,t=e=0;e<=3;t=++e)n=new j(this.randomX(),this.randomY()),n.label="P"+t,i.addPoint(n);return i}},{key:"randomizePolyline",value:function(t){var e,n,i,r;for(i=t.vertices,e=0,n=i.length;e<n;e++)r=i[e],r.set(this.randomX(),this.randomY());return t.trigger("changed"),this}}]),e}();return t=30,e.prototype.rangeX=0,e.prototype.rangeY=0,e.prototype.rangeWidth=800,e.prototype.rangeHeight=450,e.prototype.randomizeFan=e.prototype.randomizeBow,e}();var Lt=Bt;return a.Bounds=c,a.Color=d,a.Size=f,a.Vector=u,a.Event=v,a.Object2D=b,a.Styled=x,a.App=R,a.Audio=E,a.Camera=P,a.Renderer=C,a.Scene=S,a.Bow=U,a.Circle=H,a.Ellipse=K,a.Fan=G,a.Line=W,a.Point=j,a.Polygon=Q,a.Polyline=et,a.Rectangle=it,a.Spline=st,a.Triangle=J,a.Image=at,a.PointText=D,a.Animation=dt,a.AnimationRunner=ft,a.AnimationTask=lt,a.DashFlowManager=mt,a.SpriteSheet=_t,a.InputManager=F,a.MouseControl=Pt,a.geometryAlgorithm=Ct,a.ShapeRandomizer=Lt,a}();