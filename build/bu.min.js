// Bu.js - https://github.com/jarvisniu/Bu.js
(function(){var t,n,e,r,o,s,u,a={}.hasOwnProperty,h=function(t,n){return function(){return t.apply(n,arguments)}},c=function(t,n){function e(){this.constructor=t}for(var i in n)a.call(n,i)&&(t[i]=n[i]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},l=[].indexOf||function(t){for(var n=0,e=this.length;n<e;n++)if(n in this&&this[n]===t)return n;return-1};u=o,o=window||this,o.Bu=function(){return function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(Bu.Renderer,arguments,function(){})},Bu.global=o,o=u,Bu.VERSION="0.3.4",Bu.HALF_PI=Math.PI/2,Bu.TWO_PI=2*Math.PI,Bu.DEFAULT_STROKE_STYLE="#048",Bu.DEFAULT_FILL_STYLE="rgba(64, 128, 192, 0.5)",Bu.DEFAULT_DASH_STYLE=[8,4],Bu.DEFAULT_STROKE_STYLE_HOVER="rgba(255, 128, 0, 0.75)",Bu.DEFAULT_FILL_STYLE_HOVER="rgba(255, 128, 128, 0.5)",Bu.DEFAULT_TEXT_FILL_STYLE="black",Bu.POINT_RENDER_SIZE=2.25,Bu.POINT_LABEL_OFFSET=5,Bu.DEFAULT_BOUND_STROKE_STYLE="#444",Bu.DEFAULT_BOUND_DASH_STYLE=[6,6],Bu.DEFAULT_SPLINE_SMOOTH=.25,Bu.DEFAULT_NEAR_DIST=5,Bu.MOUSE_BUTTON_NONE=-1,Bu.MOUSE_BUTTON_LEFT=0,Bu.MOUSE_BUTTON_MIDDLE=1,Bu.MOUSE_BUTTON_RIGHT=2,Bu.average=function(){var t,n,e,i,r;for(i=arguments,"object"==typeof arguments[0]&&(i=arguments[0]),r=0,n=0,e=i.length;n<e;n++)t=i[n],r+=t;return r/i.length},Bu.bevel=function(t,n){return Math.sqrt(t*t+n*n)},Bu.clamp=function(t,n,e){return t<n&&(t=n),t>e&&(t=e),t},Bu.rand=function(t,n){return null==n&&(n=t,t=0),Math.random()*(n-t)+t},Bu.r2d=function(t){return(180*t/Math.PI).toFixed(1)},Bu.d2r=function(t){return t*Math.PI/180},Bu.now=null!=Bu.global.performance?function(){return Bu.global.performance.now()}:function(){return Date.now()},Bu.combineOptions=function(t,n){var e,i;if(null==n&&(n={}),e=t[t.length-1],"object"==typeof e)for(i in e)null!=e[i]&&(n[i]=e[i]);return n},Bu.isPlainObject=function(t){return t instanceof Object&&"Object"===t.constructor.name},Bu.isFunction=function(t){return t instanceof Object&&"Function"===t.constructor.name},Bu.clone=function(t){var n,e;if("object"!=typeof t||null===t||Bu.isFunction(t))return t;n=t instanceof Array?[]:Bu.isPlainObject(t)?{}:Object.create(t.constructor.prototype);for(e in t)a.call(t,e)&&(n[e]=Bu.clone(t[e]));return"Function"===n.constructor.name&&console.log(n),n},Bu.data=function(t,n){return null!=n?localStorage["Bu."+t]=JSON.stringify(n):(n=localStorage["Bu."+t],null!=n?JSON.parse(n):null)},Function.prototype.property=function(t,n){return Object.defineProperty(this.prototype,t,n)},Function.prototype.throttle=function(t){var n,e;return null==t&&(t=.5),n=0,e=0,function(i){return function(){if(n=Date.now(),n-e>1e3*t)return i.apply(null,arguments),e=n}}(this)},Function.prototype.debounce=function(t){var n,e,i;return null==t&&(t=.5),n=null,i=null,e=function(t){return function(){return t.apply(null,n)}}(this),function(){return n=arguments,clearTimeout(i),i=setTimeout(e,1e3*t)}},(n=Array.prototype).each||(n.each=function(t){var n;for(n=0;n<this.length;)t(this[n]),n++;return this}),(e=Array.prototype).map||(e.map=function(t){var n,e;for(n=[],e=0;e<this.length;)n.push(t(this[e])),e++;return this}),s=Bu.data("lastInfo"),r=Date.now(),null!=s&&r-s<6e4||("function"==typeof console.info&&console.info("Bu.js v"+Bu.VERSION+" - [https://github.com/jarvisniu/Bu.js]"),Bu.data("lastInfo",r)),Bu.Bounds=function(){function t(t){var n,e,i,r,o,s,u;switch(this.target=t,this.x1=this.y1=this.x2=this.y2=0,this.isEmpty=!0,this.point1=new Bu.Vector,this.point2=new Bu.Vector,this.strokeStyle=Bu.DEFAULT_BOUND_STROKE_STYLE,this.dashStyle=Bu.DEFAULT_BOUND_DASH_STYLE,this.dashOffset=0,this.target.type){case"Line":case"Triangle":case"Rectangle":for(o=this.target.points,n=0,e=o.length;n<e;n++)u=o[n],this.expandByPoint(u);break;case"Circle":case"Bow":case"Fan":this.expandByCircle(this.target),this.target.on("centerChanged",function(t){return function(){return t.clear(),t.expandByCircle(t.target)}}(this)),this.target.on("radiusChanged",function(t){return function(){return t.clear(),t.expandByCircle(t.target)}}(this));break;case"Polyline":case"Polygon":for(s=this.target.vertices,r=0,i=s.length;r<i;r++)u=s[r],this.expandByPoint(u);break;default:console.warn('Bounds: not support shape type "'+this.target.type+'"')}}return t.prototype.containsPoint=function(t){return this.x1<t.x&&this.x2>t.x&&this.y1<t.y&&this.y2>t.y},t.prototype.clear=function(){return this.x1=this.y1=this.x2=this.y2=0,this.isEmpty=!0},t.prototype.expandByPoint=function(t){return this.isEmpty?(this.isEmpty=!1,this.x1=this.x2=t.x,this.y1=this.y2=t.y):(t.x<this.x1&&(this.x1=t.x),t.x>this.x2&&(this.x2=t.x),t.y<this.y1&&(this.y1=t.y),t.y>this.y2?this.y2=t.y:void 0)},t.prototype.expandByCircle=function(t){var n,e;return n=t.center,e=t.radius,this.isEmpty?(this.isEmpty=!1,this.x1=n.x-e,this.x2=n.x+e,this.y1=n.y-e,this.y2=n.y+e):(n.x-e<this.x1&&(this.x1=n.x-e),n.x+e>this.x2&&(this.x2=n.x+e),n.y-e<this.y1&&(this.y1=n.y-e),n.y+e>this.y2?this.y2=n.y+e:void 0)},t}(),Bu.Color=function(){function t(){var t;0===arguments.length&&(this.r=this.g=this.b=255,this.a=1),1===arguments.length?(t=arguments[0],"string"==typeof t?(this.parse(t),this.a=a(this.a)):t instanceof Bu.Color&&this.copy(t)):(this.r=arguments[0],this.g=arguments[1],this.b=arguments[2],this.a=arguments[3]||1)}var n,e,i,r,o,s,u,a;return t.prototype.parse=function(t){var a,h;return(a=t.match(o))?(this.r=parseInt(a[1]),this.g=parseInt(a[2]),this.b=parseInt(a[3]),this.a=parseFloat(a[4])):(a=t.match(r))?(this.r=parseInt(a[1]),this.g=parseInt(a[2]),this.b=parseInt(a[3]),this.a=1):(a=t.match(s))?(this.r=parseInt(255*a[1]/100),this.g=parseInt(255*a[2]/100),this.b=parseInt(255*a[3]/100),this.a=parseFloat(a[4])):(a=t.match(u))?(this.r=parseInt(255*a[1]/100),this.g=parseInt(255*a[2]/100),this.b=parseInt(255*a[3]/100),this.a=1):(a=t.match(e))?(h=a[1],this.r=parseInt(h[0],16),this.r=16*this.r+this.r,this.g=parseInt(h[1],16),this.g=16*this.g+this.g,this.b=parseInt(h[2],16),this.b=16*this.b+this.b,this.a=1):(a=t.match(i))?(h=a[1],this.r=parseInt(h.substring(0,2),16),this.g=parseInt(h.substring(2,4),16),this.b=parseInt(h.substring(4,6),16),this.a=1):null!=n[t=t.toLowerCase().trim()]?(this.r=n[t][0],this.g=n[t][1],this.b=n[t][2],this.a=n[t][3],null==this.a&&(this.a=1)):console.error('Bu.Color.parse("'+t+'") error.'),this},t.prototype.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.setRGB=function(t,n,e){return this.r=parseInt(t),this.g=parseInt(n),this.b=parseInt(e),this.a=1,this},t.prototype.setRGBA=function(t,n,e,i){return this.r=parseInt(t),this.g=parseInt(n),this.b=parseInt(e),this.a=a(parseFloat(i)),this},t.prototype.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},t.prototype.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.a+")"},a=function(t){return Bu.clamp(t,0,1)},r=/rgb\(\s*(\d+),\s*(\d+),\s*(\d+)\s*\)/i,o=/rgba\(\s*(\d+),\s*(\d+),\s*(\d+)\s*,\s*([.\d]+)\s*\)/i,u=/rgb\(\s*(\d+)%,\s*(\d+)%,\s*(\d+)%\s*\)/i,s=/rgba\(\s*(\d+)%,\s*(\d+)%,\s*(\d+)%\s*,\s*([.\d]+)\s*\)/i,e=/#([0-9A-F]{3})\s*$/i,i=/#([0-9A-F]{6})\s*$/i,n={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},t}(),Bu.Size=function(){function t(t,n){this.width=t,this.height=n,this.type="Size"}return t.prototype.set=function(t,n){return this.width=t,this.height=n},t}(),Bu.Vector=function(){function t(t,n){this.x=null!=t?t:0,this.y=null!=n?n:0}return t.prototype.set=function(t,n){this.x=t,this.y=n},t}(),Bu.App=function(){function t(t){var n,e,i,r,o;for(this.options=null!=t?t:{},o=["canvas","camera","data","objects","hierarchy","methods","events"],i=0,r=o.length;i<r;i++)e=o[i],(n=this.options)[e]||(n[e]={});"complete"===document.readyState?this.init():document.addEventListener("DOMContentLoaded",function(t){return function(){return t.init()}}(this))}return t.prototype.$objects={},t.prototype.init=function(){var t,n,e,i,r,o;this.$canvas=new Bu({container:this.options.canvas.container,showKeyPoints:this.options.canvas.showKeyPoints,background:this.options.canvas.background}),(n=this.$canvas.dom.style).cursor&&(n.cursor=this.options.canvas.cursor);for(e in this.options.data)this[e]=this.options.data[e];for(e in this.options.methods)this[e]=this.options.methods[e];if(this.options.objects instanceof Function)this.$objects=this.options.objects.apply(this);else for(i in this.options.objects)this.$objects[i]=this.options.objects[i];t=function(n){return function(e,r){var o;o=[];for(i in e)a.call(e,i)&&(r.push(n.$objects[i]),o.push(t(e[i],n.$objects[i].children)));return o}}(this),t(this.options.hierarchy,this.$canvas.shapes),null!=(r=this.options.init)&&r.call(this),this.events=this.options.events;for(o in this.events)"mousedown"===o?this.$canvas.dom.addEventListener("mousedown",function(t){return function(n){return t.events.mousedown.call(t,n)}}(this)):"mousemove"===o?this.$canvas.dom.addEventListener("mousemove",function(t){return function(n){return t.events.mousemove.call(t,n)}}(this)):"mouseup"===o&&this.$canvas.dom.addEventListener("mouseup",function(t){return function(n){return t.events.mouseup.call(t,n)}}(this));if(null!=this.options.update)return this.$canvas.on("update",function(t){return function(){return t.options.update.apply(t,arguments)}}(this))},t.prototype.trigger=function(t,n){var e;return null!=(e=this.events[t])?e.call(this,n):void 0},t}(),Bu.Colorful=function(){return this.strokeStyle=Bu.DEFAULT_STROKE_STYLE,this.fillStyle=Bu.DEFAULT_FILL_STYLE,this.dashStyle=!1,this.lineWidth=1,this.dashOffset=0,this.stroke=function(t){switch(null==t&&(t=!0),t){case!0:this.strokeStyle=Bu.DEFAULT_STROKE_STYLE;break;case!1:this.strokeStyle=null;break;default:this.strokeStyle=t}return this},this.fill=function(t){switch(null==t&&(t=!0),t){case!1:this.fillStyle=null;break;case!0:this.fillStyle=Bu.DEFAULT_FILL_STYLE;break;default:this.fillStyle=t}return this},this.dash=function(t){switch(null==t&&(t=!0),"number"==typeof t&&(t=[t,t]),t){case!1:this.dashStyle=null;break;case!0:this.dashStyle=Bu.DEFAULT_DASH_STYLE;break;default:this.dashStyle=t}return this}},Bu.Event=function(){var t;return t={},this.on=function(n,e){var i;if(i=t[n]||(t[n]=[]),i.indexOf(e===-1))return i.push(e)},this.once=function(t,n){return n.once=!0,this.on(t,n)},this.off=function(n,e){var i,r;if(r=t[n],null!=e){if(null!=r&&(i=r.indexOf(e),i>-1))return r.splice(i,1)}else if(null!=r)return r.length=0},this.trigger=function(n,e){var r,o,s,u,a;if(u=t[n],null!=u){for(e||(e={}),e.target=this,a=[],r=0,o=u.length;r<o;r++)s=u[r],s.call(this,e),s.once?(u.splice(i,1),a.push(i-=1)):a.push(void 0);return a}}},function(t){var n;return t.$=function(t){var e;return e=[],"string"==typeof t&&(e=[].slice.call(document.querySelectorAll(t))),n.apply(e),e},n=function(){var t;return this.on=function(t){return function(n,e){return t.each(function(t){return t.addEventListener(n,e)}),t}}(this),this.off=function(t){return function(n,e){return t.each(function(t){return t.removeEventListener(n,e)}),t}}(this),t="svg line rect circle ellipse polyline polygon path text",this.append=function(n){return function(e){return n.each(function(i,r){var o,s;return s=t.indexOf(e.toLowerCase()),o=s>-1?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e),n[r]=i.appendChild(o)}),n}}(this),this.text=function(t){return function(n){return t.each(function(t){return t.textContent=n}),t}}(this),this.html=function(t){return function(n){return t.each(function(t){return t.innerHTML=n}),t}}(this),this.style=function(t){return function(n,e){return t.each(function(t){var i,r,o;r=t.getAttribute("style"),o={},r&&r.split(";").each(function(t){var n;return n=t.split(":"),o[n[0]]=n[1]}),o[n]=e,r="";for(i in o)r+=i+": "+o[i]+"; ";return t.setAttribute("style",r)}),t}}(this),this.hasClass=function(t){return function(n){var e,i,r;if(0===t.length)return!1;for(r=0;r<t.length;){if(e=t[r].getAttribute("class"),i=e.split(RegExp(" +")),!i.contains(n))return!1;r++}return t}}(this),this.addClass=function(t){return function(n){return t.each(function(t){var e,i;if(e=t.getAttribute("class"),i=e.split(RegExp(" +")),!i.contains(n))return i.push(n),t.setAttribute("class",i.join(" "))}),t}}(this),this.removeClass=function(t){return function(n){return t.each(function(t){var e,i;if(e=t.getAttribute("class")||"",i=e.split(RegExp(" +")),i.contains(n))return i.remove(n),i.length>0?t.setAttribute("class",i.join(" ")):t.removeAttribute("class")}),t}}(this),this.toggleClass=function(t){return function(n){return t.each(function(t){var e,i;return e=t.getAttribute("class"),i=e.split(RegExp(" +")),i.contains(n)?i.remove(n):i.push(n),i.length>0?t.setAttribute("class",i.join(" ")):t.removeAttribute("class")}),t}}(this),this.attr=function(t){return function(n,e){return null!=e?(t.each(function(t){return t.setAttribute(n,e)}),t):t[0].getAttribute(n)}}(this),this.hasAttr=function(t){return function(n){var e;if(0===t.length)return!1;for(e=0;e<t.length;){if(!t[e].hasAttribute(n))return!1;e++}return t}}(this),this.removeAttr=function(t){return function(n){return t.each(function(t){return t.removeAttribute(n)}),t}}(this),this.val=function(t){return function(){var n;return null!=(n=t[0])?n.value:void 0}}(this)},t.$.ready=function(t){return document.addEventListener("DOMContentLoaded",t)},t.$.ajax=function(t,n){var e;return n||("object"==typeof t?(n=t,t=n.url):n={}),n.method||(n.method="GET"),null==n.async&&(n.async=!0),e=new XMLHttpRequest,e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status){if(null!=n.success)return n.success(e.responseText,e.status,e)}else if(null!=n.error&&n.error(e,e.status),null!=n.complete)return n.complete(e,e.status)},e.open(n.method,t,n.async,n.username,n.password),e.send(null)}}(Bu.global),Bu.Object2D=function(){function t(){Bu.Colorful.apply(this),Bu.Event.apply(this),this.visible=!0,this.opacity=1,this.position=new Bu.Vector,this.rotation=0,this._scale=new Bu.Vector(1,1),this.skew=new Bu.Vector,this.bounds=null,this.keyPoints=null,this.children=[],this.parent=null}return t.property("scale",{get:function(){return this._scale},set:function(t){return"number"==typeof t?this._scale.x=this._scale.y=t:this._scale=t}}),t.prototype.animate=function(t,n){var e;if("string"==typeof t)t in Bu.animations?Bu.animations[t].apply(this,n):console.warn('Bu.animations["'+t+"\"] doesn't exists.");else if(t instanceof Array){n instanceof Array||(n=[n]);for(e in t)a.call(t,e)&&this.animate(t[e],n)}else t.apply(this,n);return this},t.prototype.containsPoint=function(t){return!(null!=this.bounds&&!this.bounds.containsPoint(t))&&(!!this._containsPoint&&this._containsPoint(t))},t}(),Bu.Renderer=function(){function t(){this.drawShape=h(this.drawShape,this),this.drawShapes=h(this.drawShapes,this);var t,n,e,i,r,o,s,u;for(Bu.Event.apply(this),this.type="Renderer",r=Bu.combineOptions(arguments,{container:"body",fps:60,showKeyPoints:!1,background:"#eee"}),o=["container","width","height","fps","showKeyPoints","width","height"],n=0,e=o.length;n<e;n++)t=o[n],this[t]=r[t];"string"==typeof this.container&&(this.container=document.querySelector(this.container)),this.fillParent="number"!=typeof this.width,this.tickCount=0,this.isRunning=!1,this.pixelRatio=Bu.global.devicePixelRatio||1,this.dom=document.createElement("canvas"),this.context=this.dom.getContext("2d"),this.context.textBaseline="top","undefined"!=typeof ClipMeter&&null!==ClipMeter&&(this.clipMeter=new ClipMeter),this.shapes=[],this.fillParent||(this.dom.style.width=this.width+"px",this.dom.style.height=this.height+"px",this.dom.width=this.width*this.pixelRatio,this.dom.height=this.height*this.pixelRatio),this.dom.style.cursor=r.cursor||"default",this.dom.style.boxSizing="content-box",this.dom.style.background=r.background,this.dom.oncontextmenu=function(){return!1},i=function(t){return function(){var n,e,i,r;return n=t.dom.height/t.dom.width,e=t.container.clientHeight/t.container.clientWidth,e<n?(i=t.container.clientHeight,r=i/e):(r=t.container.clientWidth,i=r*e),t.width=t.dom.width=r*t.pixelRatio,t.height=t.dom.height=i*t.pixelRatio,t.dom.style.width=r+"px",t.dom.style.height=i+"px",t.render()}}(this),this.fillParent&&(this.width=this.container.clientWidth,this.height=this.container.clientHeight,Bu.global.window.addEventListener("resize",i),this.dom.addEventListener("DOMNodeInserted",i)),u=function(t){return function(){return t.isRunning&&(null!=t.clipMeter&&t.clipMeter.start(),t.render(),t.trigger("update",{tickCount:t.tickCount}),t.tickCount+=1,null!=t.clipMeter&&t.clipMeter.tick()),requestAnimationFrame(u)}}(this),u(),setTimeout(function(t){return function(){return t.container.appendChild(t.dom)}}(this),100),null!=(s=Bu.animationRunner)&&s.hookUp(this),this.isRunning=!0}return t.prototype.pause=function(){return this.isRunning=!1},t.prototype["continue"]=function(){return this.isRunning=!0},t.prototype.toggle=function(){return this.isRunning=!this.isRunning},t.prototype.add=function(t){var n,e,i;if(t instanceof Array)for(n=0,e=t.length;n<e;n++)i=t[n],this.shapes.push(i);else this.shapes.push(t);return this},t.prototype.remove=function(t){var n;return n=this.shapes.indexOf(t),n>-1&&this.shapes.splice(n,1),this},t.prototype.render=function(){return this.context.save(),this.context.scale(this.pixelRatio,this.pixelRatio),this.clearCanvas(),this.drawShapes(this.shapes),this.context.restore(),this},t.prototype.clearCanvas=function(){return this.context.clearRect(0,0,this.width,this.height),this},t.prototype.drawShapes=function(t){var n,e,i;if(null!=t)for(n=0,e=t.length;n<e;n++)i=t[n],this.context.save(),this.drawShape(i),this.context.restore();return this},t.prototype.drawShape=function(t){var n,e,i;if(!t.visible)return this;switch(this.context.translate(t.position.x,t.position.y),this.context.rotate(t.rotation),e=t.scale.x,i=t.scale.y,(e/i>100||e/i<.01)&&(Math.abs(e)<.02&&(e=0),Math.abs(i)<.02&&(i=0)),this.context.scale(e,i),this.context.globalAlpha*=t.opacity,null!=t.strokeStyle&&(this.context.strokeStyle=t.strokeStyle,this.context.lineWidth=t.lineWidth,null!=t.lineCap&&(this.context.lineCap=t.lineCap),null!=t.lineJoin&&(this.context.lineJoin=t.lineJoin)),this.context.beginPath(),t.type){case"Point":this.drawPoint(t);break;case"Line":this.drawLine(t);break;case"Circle":this.drawCircle(t);break;case"Triangle":this.drawTriangle(t);break;case"Rectangle":this.drawRectangle(t);break;case"Fan":this.drawFan(t);break;case"Bow":this.drawBow(t);break;case"Polygon":this.drawPolygon(t);break;case"Polyline":this.drawPolyline(t);break;case"Spline":this.drawSpline(t);break;case"PointText":this.drawPointText(t);break;case"Image":this.drawImage(t);break;case"Bounds":this.drawBounds(t);break;case"Group":break;default:console.log("drawShapes(): unknown shape: ",t)}return null!=t.fillStyle&&(this.context.fillStyle=t.fillStyle,this.context.fill()),t.dashStyle?(this.context.lineDashOffset=t.dashOffset,"function"==typeof(n=this.context).setLineDash&&n.setLineDash(t.dashStyle),this.context.stroke(),this.context.setLineDash([])):null!=t.strokeStyle&&this.context.stroke(),null!=t.children&&this.drawShapes(t.children),this.showKeyPoints&&this.drawShapes(t.keyPoints),this},t.prototype.drawPoint=function(t){return this.context.arc(t.x,t.y,Bu.POINT_RENDER_SIZE,0,2*Math.PI),this},t.prototype.drawLine=function(t){return this.context.moveTo(t.points[0].x,t.points[0].y),this.context.lineTo(t.points[1].x,t.points[1].y),this},t.prototype.drawCircle=function(t){return this.context.arc(t.cx,t.cy,t.radius,0,2*Math.PI),this},t.prototype.drawTriangle=function(t){return this.context.lineTo(t.points[0].x,t.points[0].y),this.context.lineTo(t.points[1].x,t.points[1].y),this.context.lineTo(t.points[2].x,t.points[2].y),this.context.closePath(),this},t.prototype.drawRectangle=function(t){return 0!==t.cornerRadius?this.drawRoundRectangle(t):(this.context.rect(t.pointLT.x,t.pointLT.y,t.size.width,t.size.height),this)},t.prototype.drawRoundRectangle=function(t){var n,e,i,r,o,s;return i=t.pointLT.x,r=t.pointRB.x,o=t.pointLT.y,s=t.pointRB.y,e=t.cornerRadius,this.context.moveTo(i,o+e),this.context.arcTo(i,o,i+e,o,e),this.context.lineTo(r-e,o),this.context.arcTo(r,o,r,o+e,e),this.context.lineTo(r,s-e),this.context.arcTo(r,s,r-e,s,e),this.context.lineTo(i+e,s),this.context.arcTo(i,s,i,s-e,e),this.context.closePath(),null!=t.strokeStyle&&t.dashStyle&&"function"==typeof(n=this.context).setLineDash&&n.setLineDash(t.dashStyle),this},t.prototype.drawFan=function(t){return this.context.arc(t.cx,t.cy,t.radius,t.aFrom,t.aTo),this.context.lineTo(t.cx,t.cy),this.context.closePath(),this},t.prototype.drawBow=function(t){return this.context.arc(t.cx,t.cy,t.radius,t.aFrom,t.aTo),this.context.closePath(),this},t.prototype.drawPolygon=function(t){var n,e,i,r;for(r=t.vertices,n=0,e=r.length;n<e;n++)i=r[n],this.context.lineTo(i.x,i.y);return this.context.closePath(),this},t.prototype.drawPolyline=function(t){var n,e,i,r;for(r=t.vertices,n=0,e=r.length;n<e;n++)i=r[n],this.context.lineTo(i.x,i.y);return this},t.prototype.drawSpline=function(t){var n,e,i,r;if(null!=t.strokeStyle)if(i=t.vertices.length,2===i)this.context.moveTo(t.vertices[0].x,t.vertices[0].y),this.context.lineTo(t.vertices[1].x,t.vertices[1].y);else if(i>2)for(this.context.moveTo(t.vertices[0].x,t.vertices[0].y),n=e=1,r=i-1;1<=r?e<=r:e>=r;n=1<=r?++e:--e)this.context.bezierCurveTo(t.controlPointsBehind[n-1].x,t.controlPointsBehind[n-1].y,t.controlPointsAhead[n].x,t.controlPointsAhead[n].y,t.vertices[n].x,t.vertices[n].y);return this},t.prototype.drawPointText=function(t){var n,e,i,r,o,s,u,a;if("string"==typeof t.font)this.context.textAlign=t.textAlign,this.context.textBaseline=t.textBaseline,this.context.font=t.font,null!=t.strokeStyle&&this.context.strokeText(t.text,t.x,t.y),null!=t.fillStyle&&(this.context.fillStyle=t.fillStyle,this.context.fillText(t.text,t.x,t.y));else if(t.font instanceof Bu.SpriteSheet&&t.font.ready)for(s=t.font.measureTextWidth(t.text),u=function(){switch(t.textAlign){case"left":return 0;case"center":return-s/2;case"right":return-s}}(),a=function(){switch(t.textBaseline){case"top":return 0;case"middle":return-t.font.height/2;case"bottom":return-t.font.height}}(),i=r=0,o=t.text.length;0<=o?r<o:r>o;i=0<=o?++r:--r)n=t.text[i],e=t.font.getFrameImage(n),null!=e?(this.context.drawImage(e,t.x+u,t.y+a),u+=e.width):u+=10;return this},t.prototype.drawImage=function(t){var n,e,i,r;return t.loaded&&(r=t.size.width,i=t.size.height,n=-r*t.pivot.x,e=-i*t.pivot.y,this.context.drawImage(t.image,n,e,r,i)),this},t.prototype.drawBounds=function(t){return this.context.rect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1),this},t}(),Bu.Bow=function(t){function n(t,e,i,r,o){var s;this.cx=t,this.cy=e,this.radius=i,this.aFrom=r,this.aTo=o,n.__super__.constructor.call(this),this.type="Bow",this.aFrom>this.aTo&&(s=[this.aTo,this.aFrom],this.aFrom=s[0],this.aTo=s[1]),this.center=new Bu.Point(this.cx,this.cy),this.string=new Bu.Line(this.center.arcTo(this.radius,this.aFrom),this.center.arcTo(this.radius,this.aTo)),this.keyPoints=this.string.points}return c(n,t),n.prototype.clone=function(){return new Bu.Bow(this.cx,this.cy,this.radius,this.aFrom,this.aTo)},n}(Bu.Object2D),Bu.Circle=function(t){function n(t,e,i){this._radius=null!=t?t:1,null==e&&(e=0),null==i&&(i=0),n.__super__.constructor.call(this),this.type="Circle",this._center=new Bu.Point(e,i),this.bounds=null,this.keyPoints=[this._center]}return c(n,t),n.prototype.clone=function(){return new Bu.Circle(this.radius,this.cx,this.cy)},n.property("cx",{get:function(){return this._center.x},set:function(t){return this._center.x=t,this.trigger("centerChanged",this)}}),n.property("cy",{get:function(){return this._center.y},set:function(t){return this._center.y=t,this.trigger("centerChanged",this)}}),n.property("center",{get:function(){return this._center},set:function(t){return this._center=t,this.cx=t.x,this.cy=t.y,this.keyPoints[0]=t,this.trigger("centerChanged",this)}}),n.property("radius",{get:function(){return this._radius},set:function(t){return this._radius=t,this.trigger("radiusChanged",this),this}}),n}(Bu.Object2D),Bu.Fan=function(t){function n(t,e,i,r,o){this.cx=t,this.cy=e,this.radius=i,this.aFrom=r,this.aTo=o,n.__super__.constructor.call(this),this.type="Fan",this.center=new Bu.Point(this.cx,this.cy),this.string=new Bu.Line(this.center.arcTo(this.radius,this.aFrom),this.center.arcTo(this.radius,this.aTo)),this.keyPoints=[this.string.points[0],this.string.points[1],new Bu.Point(this.cx,this.cy)]}return c(n,t),n.prototype.clone=function(){return new Bu.Fan(this.cx,this.cy,this.radius,this.aFrom,this.aTo)},n}(Bu.Object2D),Bu.Line=function(t){function n(t,e,i,r){n.__super__.constructor.call(this),this.type="Line",arguments.length<2?this.points=[new Bu.Point,new Bu.Point]:arguments.length<4?this.points=[t.clone(),e.clone()]:this.points=[new Bu.Point(t,e),new Bu.Point(i,r)],this.length=0,this.midpoint=new Bu.Point,this.keyPoints=this.points,this.on("pointChange",function(t){return function(){return t.length=t.points[0].distanceTo(t.points[1]),t.midpoint.set((t.points[0].x+t.points[1].x)/2,(t.points[0].y+t.points[1].y)/2)}}(this)),this.trigger("pointChange",this)}return c(n,t),n.prototype.clone=function(){return new Bu.Line(this.points[0],this.points[1])},n.prototype.set=function(t,n,e,i){return"undefined"!=typeof p4&&null!==p4?(this.points[0].set(t,n),this.points[1].set(e,i)):(this.points[0]=t,this.points[1]=n),this.trigger("pointChange",this),this},n.prototype.setPoint1=function(t,n){return null!=n?this.points[0].set(t,n):this.points[0].copy(t),this.trigger("pointChange",this),this},n.prototype.setPoint2=function(t,n){return null!=n?this.points[1].set(t,n):this.points[1].copy(t),this.trigger("pointChange",this),this},n}(Bu.Object2D),Bu.Point=function(t){function n(t,e){this.x=null!=t?t:0,this.y=null!=e?e:0,n.__super__.constructor.call(this),this.type="Point",this.lineWidth=.5,this._labelIndex=-1}return c(n,t),n.prototype.clone=function(){return new Bu.Point(this.x,this.y)},n.property("label",{get:function(){return this._labelIndex>-1?this.children[this._labelIndex].text:""},set:function(t){var n;return this._labelIndex===-1?(n=new Bu.PointText(t,this.x+Bu.POINT_LABEL_OFFSET,this.y,{align:"+0"}),this.children.push(n),this._labelIndex=this.children.length-1):this.children[this._labelIndex].text=t}}),n.prototype.arcTo=function(t,n){return new Bu.Point(this.x+Math.cos(n)*t,this.y+Math.sin(n)*t)},n.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.updateLabel()},n.prototype.set=function(t,n){return this.x=t,this.y=n,this.updateLabel()},n.prototype.updateLabel=function(){if(this._labelIndex>-1)return this.children[this._labelIndex].x=this.x+Bu.POINT_LABEL_OFFSET,this.children[this._labelIndex].y=this.y},n}(Bu.Object2D),Bu.Polygon=function(t){function n(t){var e,i,r,o,s,u,a,h,c,l;if(n.__super__.constructor.call(this),this.type="Polygon",this.vertices=[],this.lines=[],this.triangles=[],o=Bu.combineOptions(arguments,{angle:0}),t instanceof Array?null!=t&&(this.vertices=t):(arguments.length<4?(c=0,l=0,u=arguments[0],r=arguments[1]):(c=arguments[0],l=arguments[1],u=arguments[2],r=arguments[3]),this.vertices=Bu.Polygon.generateRegularPoints(c,l,u,r,o)),this.vertices.length>1){for(e=i=0,a=this.vertices.length-1;0<=a?i<a:i>a;e=0<=a?++i:--i)this.lines.push(new Bu.Line(this.vertices[e],this.vertices[e+1]));this.lines.push(new Bu.Line(this.vertices[this.vertices.length-1],this.vertices[0]))}if(this.vertices.length>2)for(e=s=1,h=this.vertices.length-1;1<=h?s<h:s>h;e=1<=h?++s:--s)this.triangles.push(new Bu.Triangle(this.vertices[0],this.vertices[e],this.vertices[e+1]));this.keyPoints=this.vertices}return c(n,t),n.prototype.clone=function(){return new Bu.Polygon(this.vertices)},n.prototype.isSimple=function(){var t,n,e,i,r,o,s,u;for(i=this.lines.length,t=e=0,o=i;0<=o?e<o:e>o;t=0<=o?++e:--e)for(n=r=s=t+1,u=i;s<=u?r<u:r>u;n=s<=u?++r:--r)if(this.lines[t].isCrossWithLine(this.lines[n]))return!1;return!0},n.prototype.addPoint=function(t,n){return null!=n?this.vertices.splice(n,0,t):(this.vertices.push(t),this.vertices.length>1&&(this.lines[this.lines.length-1].points[1]=t),this.vertices.length>0&&this.lines.push(new Bu.Line(this.vertices[this.vertices.length-1],this.vertices[0])),this.vertices.length>2?this.triangles.push(new Bu.Triangle(this.vertices[0],this.vertices[this.vertices.length-2],this.vertices[this.vertices.length-1])):void 0)},n.generateRegularPoints=function(t,n,e,i,r){var o,s,u,a,h,c,l,p,f,y;for(s=r.angle,l=e,c=[],u=2*Math.PI/i,a=h=0,p=i;0<=p?h<p:h>p;a=0<=p?++h:--h)o=a*u+s,f=t+l*Math.cos(o),y=n+l*Math.sin(o),c[a]=new Bu.Point(f,y);return c},n}(Bu.Object2D),Bu.Polyline=function(t){function n(t){var e,i,r,o;if(this.vertices=null!=t?t:[],n.__super__.constructor.call(this),this.type="Polyline",arguments.length>1){for(o=[],e=i=0,r=arguments.length/2;0<=r?i<r:i>r;e=0<=r?++i:--i)o.push(new Bu.Point(arguments[2*e],arguments[2*e+1]));
this.vertices=o}this.lines=[],this.keyPoints=this.vertices,this.fill(!1),this.on("pointChange",function(t){return function(){if(t.vertices.length>1)return t.updateLines(),"function"==typeof t.calcLength&&t.calcLength(),"function"==typeof t.calcPointNormalizedPos?t.calcPointNormalizedPos():void 0}}(this)),this.trigger("pointChange",this)}var e;return c(n,t),n.prototype.clone=function(){var t;return t=new Bu.Polyline(this.vertices),t.strokeStyle=this.strokeStyle,t.fillStyle=this.fillStyle,t.dashStyle=this.dashStyle,t.lineWidth=this.lineWidth,t.dashOffset=this.dashOffset,t},n.prototype.updateLines=function(){var t,n,e;for(t=n=0,e=this.vertices.length-1;0<=e?n<e:n>e;t=0<=e?++n:--n)null!=this.lines[t]?this.lines[t].set(this.vertices[t],this.vertices[t+1]):this.lines[t]=new Bu.Line(this.vertices[t],this.vertices[t+1]);return this},e=function(t){var n,e,i;for(n=e=0,i=this.vertices.length;0<=i?e<i:e>i;n=0<=i?++e:--e)this.vertices[n].copy(t[n]);return this.vertices.length>t.length&&this.vertices.splice(t.length),this.trigger("pointChange",this),this},n.prototype.addPoint=function(t,n){return null==n?(this.vertices.push(t),this.vertices.length>1&&this.lines.push(new Bu.Line(this.vertices[this.vertices.length-2],this.vertices[this.vertices.length-1]))):this.vertices.splice(n,0,t),this.trigger("pointChange",this),this},n}(Bu.Object2D),Bu.Rectangle=function(t){function n(t,e,i,r,o){null==o&&(o=0),n.__super__.constructor.call(this),this.type="Rectangle",this.center=new Bu.Point(t+i/2,e+r/2),this.size=new Bu.Size(i,r),this.pointLT=new Bu.Point(t,e),this.pointRT=new Bu.Point(t+i,e),this.pointRB=new Bu.Point(t+i,e+r),this.pointLB=new Bu.Point(t,e+r),this.points=[this.pointLT,this.pointRT,this.pointRB,this.pointLB],this.cornerRadius=o}return c(n,t),n.property("cornerRadius",{get:function(){return this._cornerRadius},set:function(t){return this._cornerRadius=t,this.keyPoints=t>0?[]:this.points}}),n.prototype.clone=function(){return new Bu.Rectangle(this.pointLT.x,this.pointLT.y,this.size.width,this.size.height)},n}(Bu.Object2D),Bu.Spline=function(t){function n(t){var i;n.__super__.constructor.call(this),this.type="Spline",t instanceof Bu.Polyline?(i=t,this.vertices=i.vertices,i.on("pointChange",function(t){return function(n){return t.vertices=n.vertices,e(t)}}(this))):this.vertices=Bu.clone(t),this.keyPoints=this.vertices,this.controlPointsAhead=[],this.controlPointsBehind=[],this.fill(!1),this.smoothFactor=Bu.DEFAULT_SPLINE_SMOOTH,this._smoother=!1,e(this)}var e;return c(n,t),n.property("smoother",{get:function(){return this._smoother},set:function(t){var n;if(n=this._smoother,this._smoother=t,n!==this._smoother)return e(this)}}),n.prototype.clone=function(){return new Bu.Spline(this.vertices)},n.prototype.addPoint=function(t){return this.vertices.push(t),e(this)},e=function(t){var n,e,i,r,o,s,u,a,h,c,l,p,f,y,d;if(t.keyPoints=t.vertices,s=t.vertices,i=s.length,i>=1&&(t.controlPointsBehind[0]=s[0]),i>=2&&(t.controlPointsAhead[i-1]=s[i-1]),i>=3){for(a=[],n=e=1,u=i-1;1<=u?e<u:e>u;n=1<=u?++e:--e)c=Math.atan2(s[n].y-s[n-1].y,s[n].x-s[n-1].x),l=Math.atan2(s[n+1].y-s[n].y,s[n+1].x-s[n].x),r=Bu.bevel(s[n].y-s[n-1].y,s[n].x-s[n-1].x),o=Bu.bevel(s[n].y-s[n+1].y,s[n].x-s[n+1].x),h=c+(l-c)*(t._smoother?r/(r+o):.5),Math.abs(h-c)>Math.PI/2&&(h+=Math.PI),p=s[n].x-r*t.smoothFactor*Math.cos(h),y=s[n].y-r*t.smoothFactor*Math.sin(h),f=s[n].x+o*t.smoothFactor*Math.cos(h),d=s[n].y+o*t.smoothFactor*Math.sin(h),t.controlPointsAhead[n]=new Bu.Point(p,y),a.push(t.controlPointsBehind[n]=new Bu.Point(f,d));return a}},n}(Bu.Object2D),Bu.Triangle=function(t){function n(t,e,i){this.clone=h(this.clone,this);var r,o,s,u,a,c;n.__super__.constructor.call(this),this.type="Triangle",6===arguments.length&&(r=arguments[0],u=arguments[1],o=arguments[2],a=arguments[3],s=arguments[4],c=arguments[5],t=new Bu.Point(r,u),e=new Bu.Point(o,a),i=new Bu.Point(s,c)),this.lines=[new Bu.Line(t,e),new Bu.Line(e,i),new Bu.Line(i,t)],this.points=[t,e,i],this.keyPoints=this.points}return c(n,t),n.prototype.clone=function(){return new Bu.Triangle(this.points[0],this.points[1],this.points[2])},n}(Bu.Object2D),Bu.Group=function(t){function n(){n.__super__.constructor.call(this),this.type="Group"}return c(n,t),n}(Bu.Object2D),Bu.Image=function(t){function n(t,e,i,r,o){this.url=t,null==e&&(e=0),null==i&&(i=0),n.__super__.constructor.call(this),this.type="Image",this.autoSize=!0,this.size=new Bu.Size,this.position=new Bu.Vector(e,i),this.center=new Bu.Vector(e+r/2,i+o/2),null!=r&&(this.size.set(r,o),this.autoSize=!1),this.pivot=new Bu.Vector(.5,.5),this.image=new Bu.global.Image,this.loaded=!1,this.image.onload=function(t){return function(n){return t.autoSize&&t.size.set(t.image.width,t.image.height),t.loaded=!0}}(this),this.image.src=this.url}return c(n,t),n}(Bu.Object2D),Bu.PointText=function(t){function n(t,e,i){var r;this.text=t,this.x=null!=e?e:0,this.y=null!=i?i:0,this.setContextAlign=h(this.setContextAlign,this),n.__super__.constructor.call(this),this.type="PointText",this.strokeStyle=null,this.fillStyle=Bu.DEFAULT_TEXT_FILL_STYLE,r=Bu.combineOptions(arguments,{align:"00",fontFamily:"Verdana",fontSize:11}),this.align=r.align,this._fontFamily=r.fontFamily,this._fontSize=r.fontSize,this.font=this._fontSize+"px "+this._fontFamily||r.font}return c(n,t),n.property("align",{get:function(){return this._align},set:function(t){return this._align=t,this.setContextAlign(this._align)}}),n.property("fontFamily",{get:function(){return this._fontFamily},set:function(t){return this._fontFamily=t,this.font=this._fontSize+"px "+this._fontFamily}}),n.property("fontSize",{get:function(){return this._fontSize},set:function(t){return this._fontSize=t,this.font=this._fontSize+"px "+this._fontFamily}}),n.prototype.setContextAlign=function(t){var n,e;return 1===t.length&&(t=""+t+t),n=t.substring(0,1),e=t.substring(1,2),this.textAlign=function(){switch(n){case"-":return"right";case"0":return"center";case"+":return"left"}}(),this.textBaseline=function(){switch(e){case"-":return"bottom";case"0":return"middle";case"+":return"top"}}()},n}(Bu.Object2D),Bu.Animation=function(){function t(t){this.from=t.from,this.to=t.to,this.data=t.data||{},this.duration=t.duration||.5,this.easing=t.easing||!1,this.repeat=!!t.repeat,this.init=t.init,this.update=t.update,this.finish=t.finish}return t.prototype.apply=function(t,n){return Bu.animationRunner.add(this,t,n)},t}(),Bu.animations={fadeIn:new Bu.Animation({update:function(t){return this.opacity=t}}),fadeOut:new Bu.Animation({update:function(t){return this.opacity=1-t}}),spin:new Bu.Animation({update:function(t){return this.rotation=t*Math.PI*2}}),spinIn:new Bu.Animation({init:function(t,n){return null==n&&(n=1),t.data.ds=n},update:function(t,n){return this.opacity=t,this.rotation=t*Math.PI*4,this.scale=t*n.ds}}),spinOut:new Bu.Animation({update:function(t){return this.opacity=1-t,this.rotation=t*Math.PI*4,this.scale=1-t}}),blink:new Bu.Animation({duration:.2,from:0,to:512,update:function(t){return t=Math.floor(Math.abs(d-256)),this.fillStyle="rgb("+t+", "+t+", "+t+")"}}),shake:new Bu.Animation({init:function(t,n){return t.data.ox=this.position.x,t.data.range=n||20},update:function(t,n){return this.position.x=Math.sin(t*Math.PI*8)*n.range+n.ox}}),puff:new Bu.Animation({duration:.15,init:function(t){return t.from={opacity:this.opacity,scale:this.scale.x},t.to=1===this.opacity?{opacity:0,scale:1.5*this.scale.x}:{opacity:1,scale:this.scale.x/1.5}},update:function(t){return this.opacity=t.opacity,this.scale=t.scale}}),clip:new Bu.Animation({init:function(t){return 0!==this.scale.y?(t.from=this.scale.y,t.to=0):(t.from=this.scale.y,t.to=this.scale.x)},update:function(t){return this.scale.y=t}}),flipX:new Bu.Animation({init:function(t){return t.from=this.scale.x,t.to=-t.from},update:function(t){return this.scale.x=t}}),flipY:new Bu.Animation({init:function(t){return t.from=this.scale.y,t.to=-t.from},update:function(t){return this.scale.y=t}}),moveTo:new Bu.Animation({init:function(t,n){return null!=n?(t.from=this.position.x,t.to=n):console.error("animation moveTo need an argument")},update:function(t){return this.position.x=t}}),moveBy:new Bu.Animation({init:function(t,n){return null!=n?(t.from=this.position.x,t.to=this.position.x+parseFloat(n)):console.error("animation moveTo need an argument")},update:function(t){return this.position.x=t}}),discolor:new Bu.Animation({init:function(t,n){return"string"==typeof n&&(n=new Bu.Color(n)),t.from=new Bu.Color(this.fillStyle),t.to=n},update:function(t){return this.fillStyle=t.toRGBA()}})},Bu.AnimationRunner=function(){function t(){this.runningAnimations=[]}var n,e,i,r,o,s,u;return t.prototype.add=function(t,n,e){var r,o;return null!=(r=t.init)&&r.call(n,t,e),u(t)?(o={animation:t,target:n,startTime:Bu.now(),current:t.data,finished:!1},this.runningAnimations.push(o),i(o,t)):console.error("Bu.AnimationRunner: animation setting is ilegal: ",animation)},t.prototype.update=function(){var t,i,r,o,u,a,h,c,l,p;for(u=Bu.now(),a=this.runningAnimations,c=[],r=0,o=a.length;r<o;r++)p=a[r],p.finished||(t=p.animation,l=(u-p.startTime)/(1e3*t.duration),l>1&&(i=!0,t.repeat?(l=0,p.startTime=Bu.now()):(l=1,p.finished=!0)),t.easing===!0?l=e[n](l):null!=e[t.easing]&&(l=e[t.easing](l)),null!=t.from?(s(p,l),t.update.apply(p.target,[p.current,l])):t.update.apply(p.target,[l,p.current]),i?c.push(null!=(h=t.finish)?h.call(p.target,t):void 0):c.push(void 0));return c},t.prototype.hookUp=function(t){return t.on("update",function(t){return function(){return t.update()}}(this))},u=function(t){var n,e;if(null==t.from||null==t.to)return!0;if(Bu.isPlainObject(t.from)){e=t.from;for(n in e)if(a.call(e,n)&&null==t.to[n])return!1}else if(null==t.to)return!1;return!0},i=function(t,n){var e,i,r;if(null!=n.from){if(Bu.isPlainObject(n.from)){i=n.from,r=[];for(e in i)a.call(i,e)&&r.push(t.current[e]=new n.from[e].constructor);return r}return t.current=new n.from.constructor}},s=function(t,n){var e,i,s,u;if(e=t.animation,"number"==typeof e.from)return t.current=r(e.from,e.to,n);if(e.from instanceof Bu.Color)return o(e.from,e.to,n,t.current);if(Bu.isPlainObject(e.from)){s=e.from,u=[];for(i in s)a.call(s,i)&&("number"==typeof e.from[i]?u.push(t.current[i]=r(e.from[i],e.to[i],n)):u.push(o(e.from[i],e.to[i],n,t.current[i])));return u}},r=function(t,n,e){return n*e-t*(e-1)},o=function(t,n,e,i){return t instanceof Bu.Color?i.setRGBA(r(t.r,n.r,e),r(t.g,n.g,e),r(t.b,n.b,e),r(t.a,n.a,e)):console.error("AnimationRunner.interpolateObject() doesn't support object type: ",t)},n="quad",e={quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quad:function(t){return t<.5?2*t*t:-2*t*t+4*t-1},cubicIn:function(t){return Math.pow(t,3)},cubicOut:function(t){return Math.pow(t-1,3)+1},cubic:function(t){return t<.5?4*Math.pow(t,3):4*Math.pow(t-1,3)+1},sineIn:function(t){return Math.sin((t-1)*Bu.HALF_PI)+1},sineOut:function(t){return Math.sin(t*Bu.HALF_PI)},sine:function(t){return t<.5?(Math.sin((2*t-1)*Bu.HALF_PI)+1)/2:Math.sin((t-.5)*Math.PI)/2+.5}},t}(),Bu.animationRunner=new Bu.AnimationRunner,Bu.SpriteSheet=function(){function t(t){this.url=t,Bu.Event.apply(this),this.ready=!1,this.height=0,this.data=null,this.images=[],this.frameImages=[],$.ajax(this.url,{success:function(t){return function(n){var e,i,r,o,s;t.data=JSON.parse(n),null==t.data.images&&(t.data.images=[t.url.substring(t.url.lastIndexOf("/"),t.url.length-5)+".png"]),e=t.url.substring(0,t.url.lastIndexOf("/")+1),o=t.data.images,s=[];for(r in o)a.call(o,r)&&(t.data.images[r]=e+t.data.images[r],i=0,t.images[r]=new Image,t.images[r].onload=function(){if(i+=1,i===t.data.images.length)return t.parseData()},s.push(t.images[r].src=t.data.images[r]));return s}}(this)})}var n,e,i;return t.prototype.parseData=function(){var t,n,i,r,o,s,u,h,c,l;n=this.data.frames;for(r in n)if(a.call(n,r)){for(o=s=0;s<=4;o=++s)null==n[r][o]&&(n[r][o]=null!=(null!=(u=n[r-1])?u[o]:void 0)?n[r-1][o]:0);c=n[r][0],l=n[r][1],h=n[r][2],i=n[r][3],t=n[r][4],this.frameImages[r]=e(this.images[t],c,l,h,i),0===this.height&&(this.height=i)}return this.ready=!0,this.trigger("loaded")},t.prototype.getFrameImage=function(t,n){var e;return null==n&&(n=0),e=this.data.animations[t],null==e?null:this.frameImages[e.frames[n]]},t.prototype.measureTextWidth=function(t){var n,e,i,r;for(r=0,e=0,i=t.length;e<i;e++)n=t[e],r+=this.getFrameImage(n).width;return r},n=document.createElement("canvas"),i=n.getContext("2d"),e=function(t,e,r,o,s){var u;return n.width=o,n.height=s,i.drawImage(t,e,r,o,s,0,0,o,s),u=new Image,u.src=n.toDataURL(),u},t}(),Bu.geometryAlgorithm=t={inject:function(){return this.injectInto(["point","line","circle","triangle","rectangle","fan","bow","polygon","polyline"])},injectInto:function(n){if("string"==typeof n&&(n=[n]),l.call(n,"point")>=0&&(Bu.Point.prototype.inCircle=function(n){return t.pointInCircle(this,n)},Bu.Point.prototype.distanceTo=function(n){return t.distanceFromPointToPoint(this,n)},Bu.Point.prototype.isNear=function(n,e){switch(null==e&&(e=Bu.DEFAULT_NEAR_DIST),n.type){case"Point":return t.pointNearPoint(this,n,e);case"Line":return t.pointNearLine(this,n,e);case"Polyline":return t.pointNearPolyline(this,n,e)}},Bu.Point.interpolate=t.interpolateBetweenTwoPoints),l.call(n,"line")>=0&&(Bu.Line.prototype.distanceTo=function(n){return t.distanceFromPointToLine(n,this)},Bu.Line.prototype.isTwoPointsSameSide=function(n,e){return t.twoPointsSameSideOfLine(n,e,this)},Bu.Line.prototype.footPointFrom=function(n,e){return t.footPointFromPointToLine(n,this,e)},Bu.Line.prototype.getCrossPointWith=function(n){return t.getCrossPointOfTwoLines(n,this)},Bu.Line.prototype.isCrossWithLine=function(n){return t.isTwoLinesCross(n,this)}),l.call(n,"circle")>=0&&(Bu.Circle.prototype._containsPoint=function(n){return t.pointInCircle(n,this)}),l.call(n,"triangle")>=0&&(Bu.Triangle.prototype._containsPoint=function(n){return t.pointInTriangle(n,this)},Bu.Triangle.prototype.area=function(){return t.calcTriangleArea(this)}),l.call(n,"rectangle")>=0&&(Bu.Rectangle.prototype.containsPoint=function(n){return t.pointInRectangle(n,this)}),l.call(n,"fan")>=0&&(Bu.Fan.prototype._containsPoint=function(n){return t.pointInFan(n,this)}),l.call(n,"bow")>=0&&(Bu.Bow.prototype._containsPoint=function(n){return t.pointInBow(n,this)}),l.call(n,"polygon")>=0&&(Bu.Polygon.prototype._containsPoint=function(n){return t.pointInPolygon(n,this)}),l.call(n,"polyline")>=0)return Bu.Polyline.prototype.length=0,Bu.Polyline.prototype.pointNormalizedPos=[],Bu.Polyline.prototype.calcLength=function(){return this.length=t.calcPolylineLength(this)},Bu.Polyline.prototype.calcPointNormalizedPos=function(){return t.calcNormalizedVerticesPosOfPolyline(this)},Bu.Polyline.prototype.getNormalizedPos=function(t){return null!=t?this.pointNormalizedPos[t]:this.pointNormalizedPos},Bu.Polyline.prototype.compress=function(n){return null==n&&(n=.8),t.compressPolyline(this,n)}},pointNearPoint:function(t,n,e){return null==e&&(e=Bu.DEFAULT_NEAR_DIST),t.distanceTo(n)<e},pointNearLine:function(t,n,e){var i,r,o,s;return null==e&&(e=Bu.DEFAULT_NEAR_DIST),s=n.distanceTo(t),i=n.footPointFrom(t),r=i.distanceTo(n.points[0])<n.length+e,o=i.distanceTo(n.points[1])<n.length+e,s<e&&r&&o},pointNearPolyline:function(n,e,i){var r,o,s,u;for(null==i&&(i=Bu.DEFAULT_NEAR_DIST),u=e.lines,r=0,o=u.length;r<o;r++)if(s=u[r],t.pointNearLine(n,s,i))return!0;return!1},pointInCircle:function(t,n){var e,i;return e=t.x-n.cx,i=t.y-n.cy,Bu.bevel(e,i)<n.radius},pointInRectangle:function(t,n){return t.x>n.pointLT.x&&t.y>n.pointLT.y&&t.x<n.pointLT.x+n.size.width&&t.y<n.pointLT.y+n.size.height},pointInTriangle:function(n,e){return t.twoPointsSameSideOfLine(n,e.points[2],e.lines[0])&&t.twoPointsSameSideOfLine(n,e.points[0],e.lines[1])&&t.twoPointsSameSideOfLine(n,e.points[1],e.lines[2])},pointInFan:function(t,n){var e,i,r;for(i=t.x-n.cx,r=t.y-n.cy,e=Math.atan2(t.y-n.cy,t.x-n.cx);e<n.aFrom;)e+=2*Math.PI;return Bu.bevel(i,r)<n.radius&&e>n.aFrom&&e<n.aTo},pointInBow:function(t,n){var e,i;return Bu.bevel(n.cx-t.x,n.cy-t.y)<n.radius&&(e=n.string.isTwoPointsSameSide(n.center,t),i=n.aTo-n.aFrom<Math.PI,e^i)},pointInPolygon:function(t,n){var e,i,r,o;for(r=n.triangles,e=0,i=r.length;e<i;e++)if(o=r[e],o.containsPoint(t))return!0;return!1},distanceFromPointToPoint:function(t,n){return Bu.bevel(t.x-n.x,t.y-n.y)},distanceFromPointToLine:function(t,n){var e,i,r,o;return r=n.points[0],o=n.points[1],e=(r.y-o.y)/(r.x-o.x),i=r.y-e*r.x,Math.abs(e*t.x+i-t.y)/Math.sqrt(e*e+1)},interpolateBetweenTwoPoints:function(t,n,e,i){var r,o;return r=t.x+(n.x-t.x)*e,o=t.y+(n.y-t.y)*e,null!=i?i.set(r,o):new Bu.Point(r,o)},twoPointsSameSideOfLine:function(t,n,e){var i,r,o,s;return i=e.points[0],r=e.points[1],i.x===r.x?(t.x-i.x)*(n.x-i.x)>0:(o=(i.y-r.y)*(t.x-i.x)/(i.x-r.x)+i.y,s=(i.y-r.y)*(n.x-i.x)/(i.x-r.x)+i.y,(t.y-o)*(n.y-s)>0)},footPointFromPointToLine:function(t,n,e){var i,r,o,s,u,a,h;return null==e&&(e=new Bu.Point),s=n.points[0],u=n.points[1],i=(s.y-u.y)/(s.x-u.x),r=s.y-i*s.x,o=t.x+i*t.y,a=(o-i*r)/(i*i+1),h=i*a+r,e.set(a,h),e},getCrossPointOfTwoLines:function(t,n){var e,i,r,o,s,u,a,h,c,l,p,f,y;return f=t.points,h=f[0],c=f[1],y=n.points,l=y[0],p=y[1],e=c.y-h.y,r=h.x-c.x,s=e*h.x+r*h.y,i=p.y-l.y,o=l.x-p.x,u=i*l.x+o*l.y,a=e*o-i*r,new Bu.Point((o*s-r*u)/a,(e*u-i*s)/a)},isTwoLinesCross:function(t,n){var e,i,r,o,s,u,a,h,c,l,p;return r=t.points[0].x,h=t.points[0].y,o=t.points[1].x,c=t.points[1].y,s=n.points[0].x,l=n.points[0].y,u=n.points[1].x,p=n.points[1].y,e=(c-h)*(u-s)-(p-l)*(o-r),0!==e&&(i=((o-r)*(u-s)*(l-h)+(c-h)*(u-s)*r-(p-l)*(o-r)*s)/e,a=((c-h)*(p-l)*(s-r)+(o-r)*(p-l)*h-(u-s)*(c-h)*l)/-e,(i-r)*(i-o)<0&&(i-s)*(i-u)<0&&(a-h)*(a-c)<0&&(a-l)*(a-p)<0)},calcPolylineLength:function(t){var n,e,i,r;if(i=0,t.vertices.length>=2)for(n=e=1,r=t.vertices.length;1<=r?e<r:e>r;n=1<=r?++e:--e)i+=t.vertices[n].distanceTo(t.vertices[n-1]);return i},calcNormalizedVerticesPosOfPolyline:function(t){var n,e,i,r,o;for(n=0,t.pointNormalizedPos[0]=0,o=[],e=i=1,r=t.vertices.length;1<=r?i<r:i>r;e=1<=r?++i:--i)n+=t.vertices[e].distanceTo(t.vertices[e-1])/t.length,o.push(t.pointNormalizedPos[e]=n);return o},compressPolyline:function(t,n){var e,i,r,o,s,u,h,c;e=[],h=t.vertices;for(i in h)a.call(h,i)&&(i<2?e[i]=t.vertices[i]:(c=e.slice(-2),o=c[0],u=c[1],s=t.vertices[i],r=Math.abs(Math.atan2(o.y-u.y,o.x-u.x)-Math.atan2(u.y-s.y,u.x-s.x)),r<n*n*Math.PI/2?e[e.length-1]=s:e.push(s)));return t.vertices=e,t.keyPoints=t.vertices,t},calcTriangleArea:function(t){var n,e,i,r;return r=t.points,n=r[0],e=r[1],i=r[2],Math.abs((e.x-n.x)*(i.y-n.y)-(i.x-n.x)*(e.y-n.y))/2}},t.inject(),Bu.RandomShapeGenerator=function(){function t(t){this.bu=t}var n;return n=30,t.prototype.randomX=function(){return Bu.rand(n,this.bu.width-2*n)},t.prototype.randomY=function(){return Bu.rand(n,this.bu.height-2*n)},t.prototype.randomRadius=function(){return Bu.rand(5,Math.min(this.bu.width,this.bu.height)/2)},t.prototype.generate=function(t){switch(t){case"circle":return this.generateCircle();case"bow":return this.generateBow();case"triangle":return this.generateTriangle();case"rectangle":return this.generateRectangle();case"fan":return this.generateFan();case"polygon":return this.generatePolygon();case"line":return this.generateLine();case"polyline":return this.generatePolyline();default:return console.warn("not support shape: "+t)}},t.prototype.generateCircle=function(){var t;return t=new Bu.Circle(this.randomRadius(),this.randomX(),this.randomY()),t.center.label="O",t},t.prototype.generateBow=function(){var t,n,e;return t=Bu.rand(2*Math.PI),n=t+Bu.rand(Math.PI/2,2*Math.PI),e=new Bu.Bow(this.randomX(),this.randomY(),this.randomRadius(),t,n),e.string.points[0].label="A",e.string.points[1].label="B",e},t.prototype.generateTriangle=function(){var t,n,e,i;for(e=[],t=n=0;n<=2;t=++n)e[t]=new Bu.Point(this.randomX(),this.randomY());return i=new Bu.Triangle(e[0],e[1],e[2]),i.points[0].label="A",i.points[1].label="B",i.points[2].label="C",i},t.prototype.generateRectangle=function(){return new Bu.Rectangle(Bu.rand(this.bu.width),Bu.rand(this.bu.height),Bu.rand(this.bu.width/2),Bu.rand(this.bu.height/2))},t.prototype.generateFan=function(){var t,n,e;return t=Bu.rand(2*Math.PI),n=t+Bu.rand(Math.PI/2,2*Math.PI),e=new Bu.Fan(this.randomX(),this.randomY(),this.randomRadius(),t,n),e.string.points[0].label="A",e.string.points[1].label="B",e},t.prototype.generatePolygon=function(){var t,n,e,i;for(i=[],t=n=0;n<=3;t=++n)e=new Bu.Point(this.randomX(),this.randomY()),e.label="P"+t,i.push(e);return new Bu.Polygon(i)},t.prototype.generateLine=function(){var t;return t=new Bu.Line(this.randomX(),this.randomY(),this.randomX(),this.randomY()),t.points[0].label="A",t.points[1].label="B",t},t.prototype.generatePolyline=function(){var t,n,e,i;for(i=new Bu.Polyline,t=n=0;n<=3;t=++n)e=new Bu.Point(this.randomX(),this.randomY()),e.label="P"+t,i.addPoint(e);return i},t}()}).call(this);